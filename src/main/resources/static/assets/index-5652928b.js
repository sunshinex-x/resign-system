import{m as Le,p as m,N as z,V as xe,o as u,e as V,f as a,w as l,D as n,O as Pe,a2 as ze,B as r,y as Be,a as w,t as g,i as C,h as f,Y as he,F as G,j,C as Re,Q as Me,R as $e,Z as Ae,a3 as Oe,a4 as Ge,ab as je,S as Ke,X as Ye,U as qe,_ as Je,$ as Qe,a0 as We,a5 as Xe,E as Ze,ac as He,ad as ea,ae as aa,af as la,aa as ta,a8 as oa,ag as sa}from"./index-df968ec9.js";/* empty css                   *//* empty css                 *//* empty css                        *//* empty css                   *//* empty css                             *//* empty css                    *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                        *//* empty css                *//* empty css               */import{_ as na}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                       */import{g as ra,p as ia,c as da,e as ua,r as pa,d as ca,a as ma,b as fa,f as _a}from"./iosTask-a938902d.js";import"./request-5c3d6a99.js";const ga={class:"app-container"},va={class:"pagination-container"},ba={key:0},ya={key:1},Ia={style:{float:"right",color:"#8492a6","font-size":"13px"}},Va={key:0},wa={style:{float:"right",color:"#8492a6","font-size":"13px"}},ka={key:1,class:"no-bundle-ids"},Ca={class:"dialog-footer"},Ea={class:"dialog-footer"},Da={__name:"index",setup(Ua){const X=Le(),B=m(!1),K=m([]);m(0);const y=z({taskId:"",status:"",appName:""}),E=m([]),_=z({page:1,size:10,total:0}),T=m(!1),D=m(1),h=m(!1),R=m(!1),Y=m(),M=m(),s=z({ipaFile:null,certificateId:"",appName:"",appVersion:"",buildVersion:"",callbackUrl:"",description:""}),Z={ipaFile:[{required:!0,message:"请上传IPA文件",trigger:"change"}],certificateId:[{required:!0,message:"请选择证书",trigger:"change"}]},b=m(null),S=m([]),q=m([]),J=m([]),L=m(!1),$=m(!1),P=z({daysToKeep:30}),v=async()=>{B.value=!0;try{const t={page:_.page,size:_.size,...y};E.value&&E.value.length===2&&(t.startDate=E.value[0],t.endDate=E.value[1]);const e=await ra(t);e.code===200?(K.value=e.data.list||[],_.total=e.data.total||0):n.error("获取任务列表失败: "+(e.message||"未知错误"))}catch{n.error("获取任务列表失败")}finally{B.value=!1}},H=()=>{_.page=1,v()},ee=()=>{Object.assign(y,{taskId:"",status:"",appName:""}),E.value=[],_.page=1,v()},ae=t=>{_.size=t,_.page=1,v()},le=t=>{_.page=t,v()},te=async()=>{T.value=!0,D.value=1,oe(),await ie(),await de()},oe=()=>{Object.assign(s,{ipaFile:null,certificateId:"",appName:"",appVersion:"",buildVersion:"",callbackUrl:"",description:""}),b.value=null,S.value=[],M.value&&M.value.clearFiles()},se=t=>{s.ipaFile=t.raw},ne=t=>{const e=t.name.toLowerCase().endsWith(".ipa"),d=t.size/1024/1024<500;return e?d?!0:(n.error("上传文件大小不能超过500MB!"),!1):(n.error("只能上传.ipa文件!"),!1)},re=async()=>{if(!s.ipaFile){n.error("请先上传IPA文件");return}R.value=!0;try{const t=new FormData;t.append("ipaFile",s.ipaFile);const e=await ia(t);e.code===200&&e.data?(b.value=e.data,e.data.bundleIdList&&e.data.bundleIdList.length>0&&(S.value=e.data.bundleIdList.map(d=>({bundleId:d,profileId:""}))),D.value=2,n.success("IPA文件解析成功")):n.error("IPA文件解析失败: "+(e.message||"未知错误"))}catch{n.error("解析IPA文件失败")}finally{R.value=!1}},ie=async()=>{try{const t=await(void 0)({platform:"IOS"});t.code===200&&t.data?q.value=t.data:console.error("加载证书列表失败:",t.message||"未知错误")}catch(t){console.error("加载证书列表失败",t)}},de=async()=>{try{const t=await(void 0)();t.code===200&&t.data?J.value=t.data:console.error("加载描述文件列表失败:",t.message||"未知错误")}catch(t){console.error("加载描述文件列表失败",t)}},ue=async()=>{try{if(await Y.value.validate(),S.value.some(p=>!p.profileId)){n.error("请为所有Bundle ID配置对应的描述文件");return}h.value=!0;const e=new FormData;e.append("ipaFile",s.ipaFile),e.append("certificateId",s.certificateId);const d={};S.value.forEach(p=>{d[p.bundleId]=p.profileId}),e.append("bundleIdConfig",JSON.stringify(d)),s.appName&&e.append("appName",s.appName),s.appVersion&&e.append("appVersion",s.appVersion),s.buildVersion&&e.append("buildVersion",s.buildVersion),s.callbackUrl&&e.append("callbackUrl",s.callbackUrl),s.description&&e.append("description",s.description);const i=await da(e);i.code===200?(n.success("任务创建成功"),T.value=!1,v()):n.error("创建任务失败: "+(i.message||"未知错误"))}catch(t){console.error("创建任务失败",t)}finally{h.value=!1}},pe=async t=>{try{const e=await ua(t.id);e.code===200?(n.success("任务已开始执行"),v()):n.error("执行任务失败: "+(e.message||"未知错误"))}catch{n.error("执行任务失败")}},ce=async t=>{try{const e=await pa(t.id);e.code===200?(n.success("任务重试成功"),v()):n.error("重试任务失败: "+(e.message||"未知错误"))}catch{n.error("重试任务失败")}},me=async t=>{try{await Re.confirm("确定要删除这个任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await ca(t.id);e.code===200?(n.success("任务删除成功"),v()):n.error("删除任务失败: "+(e.message||"未知错误"))}catch(e){e!=="cancel"&&n.error("删除任务失败")}},fe=t=>{X.push({name:"IosTaskDetail",params:{id:t.id}})},_e=async t=>{try{const e=await ma(t.id),d=new Blob([e],{type:"application/octet-stream"}),i=window.URL.createObjectURL(d),p=document.createElement("a");p.href=i,p.download=`${t.appName||"resigned"}_${t.id}.ipa`,p.click(),window.URL.revokeObjectURL(i),n.success("文件下载成功")}catch{n.error("下载文件失败")}},ge=async()=>{try{const t=await fa();t.code===200?(n.success("开始处理待处理任务"),v()):n.error("处理待处理任务失败: "+(t.message||"未知错误"))}catch{n.error("处理待处理任务失败")}},ve=()=>{L.value=!0},be=async()=>{$.value=!0;try{const t=await _a(P.daysToKeep);t.code===200?(n.success("清理过期任务完成"),L.value=!1,v()):n.error("清理过期任务失败: "+(t.message||"未知错误"))}catch{n.error("清理过期任务失败")}finally{$.value=!1}},ye=t=>({PENDING:"",PROCESSING:"warning",SUCCESS:"success",FAILED:"danger"})[t]||"",Ie=t=>({PENDING:"等待中",PROCESSING:"处理中",SUCCESS:"成功",FAILED:"失败"})[t]||t,Ve=t=>{if(!t)return"-";const e=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(t)/Math.log(1024));return Math.round(t/Math.pow(1024,d)*100)/100+" "+e[d]};return xe(()=>{v()}),(t,e)=>{const d=Me,i=$e,p=Ae,F=Oe,A=Ge,we=je,c=Ke,Q=Ye,O=qe,x=Pe,k=Je,ke=Qe,Ce=We,Ee=Xe,De=Ze,Ue=He,N=ea,Se=aa,Fe=la,W=ze,Ne=ta,Te=oa;return u(),V("div",ga,[a(x,{class:"search-card"},{default:l(()=>[a(O,{model:y,"label-width":"80px",class:"search-form"},{default:l(()=>[a(Q,{gutter:20},{default:l(()=>[a(p,{span:5},{default:l(()=>[a(i,{label:"任务ID"},{default:l(()=>[a(d,{modelValue:y.taskId,"onUpdate:modelValue":e[0]||(e[0]=o=>y.taskId=o),placeholder:"请输入任务ID",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{span:5},{default:l(()=>[a(i,{label:"任务状态"},{default:l(()=>[a(A,{modelValue:y.status,"onUpdate:modelValue":e[1]||(e[1]=o=>y.status=o),placeholder:"请选择任务状态",clearable:"",style:{width:"100%"}},{default:l(()=>[a(F,{label:"等待中",value:"PENDING"}),a(F,{label:"处理中",value:"PROCESSING"}),a(F,{label:"成功",value:"SUCCESS"}),a(F,{label:"失败",value:"FAILED"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(p,{span:5},{default:l(()=>[a(i,{label:"应用名称"},{default:l(()=>[a(d,{modelValue:y.appName,"onUpdate:modelValue":e[2]||(e[2]=o=>y.appName=o),placeholder:"请输入应用名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{span:5},{default:l(()=>[a(i,{label:"创建时间"},{default:l(()=>[a(we,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=o=>E.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{span:4},{default:l(()=>[a(i,{label:" ",class:"search-buttons"},{default:l(()=>[a(c,{type:"primary",onClick:H,icon:"Search"},{default:l(()=>e[18]||(e[18]=[r("搜索",-1)])),_:1,__:[18]}),a(c,{onClick:ee,icon:"Refresh"},{default:l(()=>e[19]||(e[19]=[r("重置",-1)])),_:1,__:[19]})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(x,{class:"operation-card"},{default:l(()=>[a(c,{type:"primary",onClick:te,icon:"Plus"},{default:l(()=>e[20]||(e[20]=[r("创建iOS重签名任务",-1)])),_:1,__:[20]}),a(c,{type:"success",onClick:ge,icon:"Refresh"},{default:l(()=>e[21]||(e[21]=[r("处理待处理任务",-1)])),_:1,__:[21]}),a(c,{type:"warning",onClick:ve,icon:"Delete"},{default:l(()=>e[22]||(e[22]=[r("清理过期任务",-1)])),_:1,__:[22]})]),_:1}),a(x,null,{default:l(()=>[Be((u(),w(Ce,{data:K.value,style:{width:"100%"}},{default:l(()=>[a(k,{prop:"taskId",label:"任务ID",width:"120"}),a(k,{prop:"appName",label:"应用名称",width:"150"}),a(k,{prop:"appVersion",label:"应用版本",width:"120"}),a(k,{prop:"buildVersion",label:"构建版本",width:"120"}),a(k,{label:"任务状态",width:"120"},{default:l(o=>[a(ke,{type:ye(o.row.status)},{default:l(()=>[r(g(Ie(o.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(k,{prop:"processingTime",label:"处理耗时",width:"120"},{default:l(o=>[r(g(o.row.processingTime?o.row.processingTime+"s":"-"),1)]),_:1}),a(k,{prop:"createTime",label:"创建时间",width:"180"}),a(k,{label:"操作",width:"300",fixed:"right"},{default:l(o=>[a(c,{type:"primary",size:"small",onClick:U=>fe(o.row)},{default:l(()=>e[23]||(e[23]=[r("详情",-1)])),_:2,__:[23]},1032,["onClick"]),o.row.status==="PENDING"?(u(),w(c,{key:0,type:"success",size:"small",onClick:U=>pe(o.row)},{default:l(()=>e[24]||(e[24]=[r("执行",-1)])),_:2,__:[24]},1032,["onClick"])):C("",!0),o.row.status==="FAILED"?(u(),w(c,{key:1,type:"warning",size:"small",onClick:U=>ce(o.row)},{default:l(()=>e[25]||(e[25]=[r("重试",-1)])),_:2,__:[25]},1032,["onClick"])):C("",!0),o.row.status==="SUCCESS"?(u(),w(c,{key:2,type:"info",size:"small",onClick:U=>_e(o.row)},{default:l(()=>e[26]||(e[26]=[r("下载",-1)])),_:2,__:[26]},1032,["onClick"])):C("",!0),a(c,{type:"danger",size:"small",onClick:U=>me(o.row)},{default:l(()=>e[27]||(e[27]=[r("删除",-1)])),_:2,__:[27]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Te,B.value]]),f("div",va,[a(Ee,{"current-page":_.page,"onUpdate:currentPage":e[4]||(e[4]=o=>_.page=o),"page-size":_.size,"onUpdate:pageSize":e[5]||(e[5]=o=>_.size=o),"page-sizes":[10,20,50,100],total:_.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:le},null,8,["current-page","page-size","total"])])]),_:1}),a(W,{modelValue:T.value,"onUpdate:modelValue":e[14]||(e[14]=o=>T.value=o),title:"创建iOS重签名任务",width:"800px","close-on-click-modal":!1},{footer:l(()=>[f("div",Ca,[D.value===2?(u(),w(c,{key:0,onClick:e[12]||(e[12]=o=>D.value=1)},{default:l(()=>e[35]||(e[35]=[r("上一步",-1)])),_:1,__:[35]})):C("",!0),a(c,{onClick:e[13]||(e[13]=o=>T.value=!1)},{default:l(()=>e[36]||(e[36]=[r("取消",-1)])),_:1,__:[36]}),D.value===2?(u(),w(c,{key:1,type:"primary",onClick:ue,loading:h.value},{default:l(()=>e[37]||(e[37]=[r("创建任务",-1)])),_:1,__:[37]},8,["loading"])):C("",!0)])]),default:l(()=>[a(O,{ref_key:"createFormRef",ref:Y,model:s,rules:Z,"label-width":"120px"},{default:l(()=>[D.value===1?(u(),V("div",ba,[e[31]||(e[31]=f("h3",null,"第一步：上传IPA文件",-1)),a(i,{label:"IPA文件",prop:"ipaFile"},{default:l(()=>[a(Ue,{ref_key:"uploadRef",ref:M,"auto-upload":!1,limit:1,"on-change":se,"before-upload":ne,accept:".ipa",drag:""},{tip:l(()=>e[28]||(e[28]=[f("div",{class:"el-upload__tip"},"只能上传.ipa文件，且不超过500MB",-1)])),default:l(()=>[a(De,{class:"el-icon--upload"},{default:l(()=>[a(he(sa))]),_:1}),e[29]||(e[29]=f("div",{class:"el-upload__text"},[r("将IPA文件拖到此处，或"),f("em",null,"点击上传")],-1))]),_:1,__:[29]},512)]),_:1}),a(i,null,{default:l(()=>[a(c,{type:"primary",onClick:re,loading:R.value,disabled:!s.ipaFile},{default:l(()=>e[30]||(e[30]=[r("解析IPA文件",-1)])),_:1,__:[30]},8,["loading","disabled"])]),_:1})])):C("",!0),D.value===2?(u(),V("div",ya,[e[34]||(e[34]=f("h3",null,"第二步：配置重签名信息",-1)),b.value?(u(),w(x,{key:0,class:"ipa-info-card"},{header:l(()=>e[32]||(e[32]=[f("span",null,"IPA文件信息",-1)])),default:l(()=>[a(Se,{column:2,border:""},{default:l(()=>[a(N,{label:"应用名称"},{default:l(()=>[r(g(b.value.appName),1)]),_:1}),a(N,{label:"应用版本"},{default:l(()=>[r(g(b.value.appVersion),1)]),_:1}),a(N,{label:"构建版本"},{default:l(()=>[r(g(b.value.buildVersion),1)]),_:1}),a(N,{label:"主Bundle ID"},{default:l(()=>[r(g(b.value.mainBundleId),1)]),_:1}),a(N,{label:"Bundle ID数量"},{default:l(()=>[r(g(b.value.bundleIdList?b.value.bundleIdList.length:0),1)]),_:1}),a(N,{label:"文件大小"},{default:l(()=>[r(g(Ve(b.value.fileSize)),1)]),_:1})]),_:1})]),_:1})):C("",!0),a(i,{label:"选择证书",prop:"certificateId"},{default:l(()=>[a(A,{modelValue:s.certificateId,"onUpdate:modelValue":e[6]||(e[6]=o=>s.certificateId=o),placeholder:"请选择iOS证书",style:{width:"100%"}},{default:l(()=>[(u(!0),V(G,null,j(q.value,o=>(u(),w(F,{key:o.id,label:o.name,value:o.id},{default:l(()=>[f("span",null,g(o.name),1),f("span",Ia,g(o.description),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"Bundle ID配置"},{default:l(()=>[a(x,{class:"bundle-config-card"},{header:l(()=>e[33]||(e[33]=[f("span",null,"配置每个Bundle ID对应的描述文件",-1)])),default:l(()=>[S.value.length>0?(u(),V("div",Va,[(u(!0),V(G,null,j(S.value,(o,U)=>(u(),V("div",{key:U,class:"bundle-config-item"},[a(Q,{gutter:20},{default:l(()=>[a(p,{span:8},{default:l(()=>[a(i,{label:"Bundle ID "+(U+1)},{default:l(()=>[a(d,{modelValue:o.bundleId,"onUpdate:modelValue":I=>o.bundleId=I,readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024),a(p,{span:16},{default:l(()=>[a(i,{label:"描述文件"},{default:l(()=>[a(A,{modelValue:o.profileId,"onUpdate:modelValue":I=>o.profileId=I,placeholder:"请选择描述文件",style:{width:"100%"}},{default:l(()=>[(u(!0),V(G,null,j(J.value,I=>(u(),w(F,{key:I.id,label:I.name,value:I.id},{default:l(()=>[f("span",null,g(I.name),1),f("span",wa,g(I.bundleId),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))])):(u(),V("div",ka,[a(Fe,{description:"暂无Bundle ID信息"})]))]),_:1})]),_:1}),a(i,{label:"应用名称"},{default:l(()=>[a(d,{modelValue:s.appName,"onUpdate:modelValue":e[7]||(e[7]=o=>s.appName=o),placeholder:"留空则使用原应用名称"},null,8,["modelValue"])]),_:1}),a(i,{label:"应用版本"},{default:l(()=>[a(d,{modelValue:s.appVersion,"onUpdate:modelValue":e[8]||(e[8]=o=>s.appVersion=o),placeholder:"留空则使用原版本"},null,8,["modelValue"])]),_:1}),a(i,{label:"构建版本"},{default:l(()=>[a(d,{modelValue:s.buildVersion,"onUpdate:modelValue":e[9]||(e[9]=o=>s.buildVersion=o),placeholder:"留空则使用原构建版本"},null,8,["modelValue"])]),_:1}),a(i,{label:"回调URL"},{default:l(()=>[a(d,{modelValue:s.callbackUrl,"onUpdate:modelValue":e[10]||(e[10]=o=>s.callbackUrl=o),placeholder:"任务完成后的回调地址"},null,8,["modelValue"])]),_:1}),a(i,{label:"任务描述"},{default:l(()=>[a(d,{modelValue:s.description,"onUpdate:modelValue":e[11]||(e[11]=o=>s.description=o),type:"textarea",placeholder:"任务描述信息"},null,8,["modelValue"])]),_:1})])):C("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(W,{modelValue:L.value,"onUpdate:modelValue":e[17]||(e[17]=o=>L.value=o),title:"清理过期任务",width:"400px"},{footer:l(()=>[f("div",Ea,[a(c,{onClick:e[16]||(e[16]=o=>L.value=!1)},{default:l(()=>e[38]||(e[38]=[r("取消",-1)])),_:1,__:[38]}),a(c,{type:"primary",onClick:be,loading:$.value},{default:l(()=>e[39]||(e[39]=[r("确认清理",-1)])),_:1,__:[39]},8,["loading"])])]),default:l(()=>[a(O,{model:P,"label-width":"120px"},{default:l(()=>[a(i,{label:"保留天数"},{default:l(()=>[a(Ne,{modelValue:P.daysToKeep,"onUpdate:modelValue":e[15]||(e[15]=o=>P.daysToKeep=o),min:1,max:365},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ya=na(Da,[["__scopeId","data-v-93206e05"]]);export{Ya as default};
