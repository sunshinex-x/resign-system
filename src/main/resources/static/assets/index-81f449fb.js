import{m as Ee,p as c,N as F,V as Ie,o as w,e as h,f as a,w as t,D as n,O as De,a2 as Ue,B as r,y as Se,a as C,t as f,i as T,h as k,Y as Fe,F as Te,j as xe,C as ze,Q as Re,R as Pe,Z as Ae,a3 as Le,a4 as Me,ab as $e,S as Be,X as Ke,U as Oe,_ as Ge,$ as he,a0 as je,a5 as Ye,E as qe,ac as Qe,ad as We,ae as Xe,a6 as Ze,a7 as He,aa as Je,a8 as ea,ag as aa}from"./index-df968ec9.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                 *//* empty css                             *//* empty css                    *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                        *//* empty css                *//* empty css               */import{_ as la}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                       */import{g as ta,p as oa,c as sa,e as na,r as ra,d as ia,a as da,b as pa,f as ua}from"./androidTask-1b67fdfa.js";import"./request-5c3d6a99.js";const ca={class:"app-container"},ma={class:"pagination-container"},fa={style:{float:"right",color:"#8492a6","font-size":"13px"}},_a={class:"dialog-footer"},ga={class:"dialog-footer"},va={__name:"index",setup(ka){const j=Ee(),x=c(!1),M=c([]);c(0);const _=F({taskId:"",status:"",appName:""}),y=c([]),u=F({page:1,size:10,total:0}),N=c(!1),z=c(!1),$=c(),R=c(),s=F({apkFile:null,certificateId:"",signatureVersion:"v1+v2",appName:"",packageName:"",versionName:"",versionCode:null,callbackUrl:"",description:""}),Y={apkFile:[{required:!0,message:"请上传APK文件",trigger:"change"}],certificateId:[{required:!0,message:"请选择证书",trigger:"change"}]},g=c(null),B=c([]),E=c(!1),P=c(!1),D=F({daysToKeep:30}),m=async()=>{try{x.value=!0;const l={page:u.page,size:u.size,..._};y.value&&y.value.length===2&&(l.startDate=y.value[0],l.endDate=y.value[1]);const e=await ta(l);e.code===200?(M.value=e.data.list||[],u.total=e.data.total||0):n.error("获取任务列表失败: "+(e.message||"未知错误"))}catch(l){console.error("获取任务列表失败",l),n.error("获取任务列表失败")}finally{x.value=!1}},q=()=>{u.page=1,m()},Q=()=>{Object.assign(_,{taskId:"",status:"",appName:""}),y.value=[],u.page=1,m()},W=l=>{u.size=l,u.page=1,m()},X=l=>{u.page=l,m()},Z=async()=>{N.value=!0,H(),await le()},H=()=>{Object.assign(s,{apkFile:null,certificateId:"",signatureVersion:"v1+v2",appName:"",packageName:"",versionName:"",versionCode:null,callbackUrl:"",description:""}),g.value=null,R.value&&R.value.clearFiles()},J=async l=>{s.apkFile=l.raw,await ae()},ee=l=>{const e=l.name.toLowerCase().endsWith(".apk"),d=l.size/1024/1024<200;return e?d?!0:(n.error("上传文件大小不能超过200MB!"),!1):(n.error("只能上传.apk文件!"),!1)},ae=async()=>{if(s.apkFile)try{const l=new FormData;l.append("apkFile",s.apkFile);const e=await oa(l);e.code===200&&e.data?(g.value=e.data,e.data.appName&&(s.appName=e.data.appName),e.data.packageName&&(s.packageName=e.data.packageName),e.data.versionName&&(s.versionName=e.data.versionName),e.data.versionCode&&(s.versionCode=e.data.versionCode),n.success("APK文件解析成功")):n.warning("APK文件解析失败: "+(e.message||"未知错误"))}catch(l){console.error("解析APK文件失败",l),n.warning("APK文件解析失败，请手动填写信息")}},le=async()=>{try{const l=await(void 0)({platform:"ANDROID"});l.code===200&&l.data?B.value=l.data:console.error("加载证书列表失败:",l.message||"未知错误")}catch(l){console.error("加载证书列表失败",l)}},te=async()=>{try{await $.value.validate(),z.value=!0;const l=new FormData;l.append("apkFile",s.apkFile),l.append("certificateId",s.certificateId),l.append("signatureVersion",s.signatureVersion),s.appName&&l.append("appName",s.appName),s.packageName&&l.append("packageName",s.packageName),s.versionName&&l.append("versionName",s.versionName),s.versionCode&&l.append("versionCode",s.versionCode),s.callbackUrl&&l.append("callbackUrl",s.callbackUrl),s.description&&l.append("description",s.description);const e=await sa(l);e.code===200?(n.success("任务创建成功"),N.value=!1,m()):n.error("任务创建失败: "+(e.message||"未知错误"))}catch(l){console.error("创建任务失败",l),n.error("任务创建失败")}finally{z.value=!1}},oe=async l=>{try{const e=await na(l.id);e.code===200?(n.success("任务已开始执行"),m()):n.error("执行任务失败: "+(e.message||"未知错误"))}catch{n.error("执行任务失败")}},se=async l=>{try{const e=await ra(l.id);e.code===200?(n.success("任务重试成功"),m()):n.error("重试任务失败: "+(e.message||"未知错误"))}catch{n.error("重试任务失败")}},ne=async l=>{try{await ze.confirm("确定要删除这个任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await ia(l.id);e.code===200?(n.success("任务删除成功"),m()):n.error("删除任务失败: "+(e.message||"未知错误"))}catch(e){e!=="cancel"&&n.error("删除任务失败")}},re=l=>{j.push({name:"AndroidTaskDetail",params:{id:l.id}})},ie=async l=>{try{const e=await da(l.id),d=new Blob([e],{type:"application/octet-stream"}),i=window.URL.createObjectURL(d),v=document.createElement("a");v.href=i,v.download=`${l.appName||"resigned"}_${l.id}.apk`,v.click(),window.URL.revokeObjectURL(i),n.success("文件下载成功")}catch{n.error("下载文件失败")}},de=async()=>{try{const l=await pa();l.code===200?(n.success("开始处理待处理任务"),m()):n.error("处理待处理任务失败: "+(l.message||"未知错误"))}catch{n.error("处理待处理任务失败")}},pe=()=>{E.value=!0},ue=async()=>{P.value=!0;try{const l=await ua(D.daysToKeep);l.code===200?(n.success("清理过期任务完成"),E.value=!1,m()):n.error("清理过期任务失败: "+(l.message||"未知错误"))}catch{n.error("清理过期任务失败")}finally{P.value=!1}},ce=l=>({PENDING:"",PROCESSING:"warning",SUCCESS:"success",FAILED:"danger"})[l]||"",me=l=>({PENDING:"等待中",PROCESSING:"处理中",SUCCESS:"成功",FAILED:"失败"})[l]||l,fe=l=>{if(!l)return"-";const e=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(l)/Math.log(1024));return Math.round(l/Math.pow(1024,d)*100)/100+" "+e[d]};return Ie(()=>{m()}),(l,e)=>{const d=Re,i=Pe,v=Ae,I=Le,K=Me,_e=$e,p=Be,ge=Ke,A=Oe,U=De,b=Ge,ve=he,ke=je,be=Ye,we=qe,ye=Qe,V=We,Ve=Xe,L=Ze,Ce=He,O=Je,G=Ue,Ne=ea;return w(),h("div",ca,[a(U,{class:"search-card"},{default:t(()=>[a(A,{model:_,"label-width":"80px",class:"search-form"},{default:t(()=>[a(ge,{gutter:20},{default:t(()=>[a(v,{span:5},{default:t(()=>[a(i,{label:"任务ID"},{default:t(()=>[a(d,{modelValue:_.taskId,"onUpdate:modelValue":e[0]||(e[0]=o=>_.taskId=o),placeholder:"请输入任务ID",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{span:5},{default:t(()=>[a(i,{label:"任务状态"},{default:t(()=>[a(K,{modelValue:_.status,"onUpdate:modelValue":e[1]||(e[1]=o=>_.status=o),placeholder:"请选择任务状态",clearable:"",style:{width:"100%"}},{default:t(()=>[a(I,{label:"等待中",value:"PENDING"}),a(I,{label:"处理中",value:"PROCESSING"}),a(I,{label:"成功",value:"SUCCESS"}),a(I,{label:"失败",value:"FAILED"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(v,{span:5},{default:t(()=>[a(i,{label:"应用名称"},{default:t(()=>[a(d,{modelValue:_.appName,"onUpdate:modelValue":e[2]||(e[2]=o=>_.appName=o),placeholder:"请输入应用名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{span:5},{default:t(()=>[a(i,{label:"创建时间"},{default:t(()=>[a(_e,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=o=>y.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{span:4},{default:t(()=>[a(i,{label:" ",class:"search-buttons"},{default:t(()=>[a(p,{type:"primary",onClick:q,icon:"Search"},{default:t(()=>e[19]||(e[19]=[r("搜索",-1)])),_:1,__:[19]}),a(p,{onClick:Q,icon:"Refresh"},{default:t(()=>e[20]||(e[20]=[r("重置",-1)])),_:1,__:[20]})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(U,{class:"operation-card"},{default:t(()=>[a(p,{type:"primary",onClick:Z,icon:"Plus"},{default:t(()=>e[21]||(e[21]=[r("创建Android重签名任务",-1)])),_:1,__:[21]}),a(p,{type:"success",onClick:de,icon:"Refresh"},{default:t(()=>e[22]||(e[22]=[r("处理待处理任务",-1)])),_:1,__:[22]}),a(p,{type:"warning",onClick:pe,icon:"Delete"},{default:t(()=>e[23]||(e[23]=[r("清理过期任务",-1)])),_:1,__:[23]})]),_:1}),a(U,null,{default:t(()=>[Se((w(),C(ke,{data:M.value,style:{width:"100%"}},{default:t(()=>[a(b,{prop:"taskId",label:"任务ID",width:"120"}),a(b,{prop:"appName",label:"应用名称",width:"150"}),a(b,{prop:"appVersion",label:"应用版本",width:"120"}),a(b,{prop:"packageName",label:"包名",width:"200"}),a(b,{label:"任务状态",width:"120"},{default:t(o=>[a(ve,{type:ce(o.row.status)},{default:t(()=>[r(f(me(o.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(b,{prop:"processingTime",label:"处理耗时",width:"120"},{default:t(o=>[r(f(o.row.processingTime?o.row.processingTime+"s":"-"),1)]),_:1}),a(b,{prop:"createTime",label:"创建时间",width:"180"}),a(b,{label:"操作",width:"300",fixed:"right"},{default:t(o=>[a(p,{type:"primary",size:"small",onClick:S=>re(o.row)},{default:t(()=>e[24]||(e[24]=[r("详情",-1)])),_:2,__:[24]},1032,["onClick"]),o.row.status==="PENDING"?(w(),C(p,{key:0,type:"success",size:"small",onClick:S=>oe(o.row)},{default:t(()=>e[25]||(e[25]=[r("执行",-1)])),_:2,__:[25]},1032,["onClick"])):T("",!0),o.row.status==="FAILED"?(w(),C(p,{key:1,type:"warning",size:"small",onClick:S=>se(o.row)},{default:t(()=>e[26]||(e[26]=[r("重试",-1)])),_:2,__:[26]},1032,["onClick"])):T("",!0),o.row.status==="SUCCESS"?(w(),C(p,{key:2,type:"info",size:"small",onClick:S=>ie(o.row)},{default:t(()=>e[27]||(e[27]=[r("下载",-1)])),_:2,__:[27]},1032,["onClick"])):T("",!0),a(p,{type:"danger",size:"small",onClick:S=>ne(o.row)},{default:t(()=>e[28]||(e[28]=[r("删除",-1)])),_:2,__:[28]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ne,x.value]]),k("div",ma,[a(be,{"current-page":u.page,"onUpdate:currentPage":e[4]||(e[4]=o=>u.page=o),"page-size":u.size,"onUpdate:pageSize":e[5]||(e[5]=o=>u.size=o),"page-sizes":[10,20,50,100],total:u.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:W,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),_:1}),a(G,{modelValue:N.value,"onUpdate:modelValue":e[15]||(e[15]=o=>N.value=o),title:"创建Android重签名任务",width:"600px","close-on-click-modal":!1},{footer:t(()=>[k("div",_a,[a(p,{onClick:e[14]||(e[14]=o=>N.value=!1)},{default:t(()=>e[35]||(e[35]=[r("取消",-1)])),_:1,__:[35]}),a(p,{type:"primary",onClick:te,loading:z.value},{default:t(()=>e[36]||(e[36]=[r("创建任务",-1)])),_:1,__:[36]},8,["loading"])])]),default:t(()=>[a(A,{ref_key:"createFormRef",ref:$,model:s,rules:Y,"label-width":"120px"},{default:t(()=>[a(i,{label:"APK文件",prop:"apkFile"},{default:t(()=>[a(ye,{ref_key:"uploadRef",ref:R,"auto-upload":!1,limit:1,"on-change":J,"before-upload":ee,accept:".apk",drag:""},{tip:t(()=>e[29]||(e[29]=[k("div",{class:"el-upload__tip"},"只能上传.apk文件，且不超过200MB",-1)])),default:t(()=>[a(we,{class:"el-icon--upload"},{default:t(()=>[a(Fe(aa))]),_:1}),e[30]||(e[30]=k("div",{class:"el-upload__text"},[r("将APK文件拖到此处，或"),k("em",null,"点击上传")],-1))]),_:1,__:[30]},512)]),_:1}),g.value?(w(),C(U,{key:0,class:"apk-info-card"},{header:t(()=>e[31]||(e[31]=[k("span",null,"APK文件信息",-1)])),default:t(()=>[a(Ve,{column:2,border:""},{default:t(()=>[a(V,{label:"应用名称"},{default:t(()=>[r(f(g.value.appName),1)]),_:1}),a(V,{label:"包名"},{default:t(()=>[r(f(g.value.packageName),1)]),_:1}),a(V,{label:"版本名称"},{default:t(()=>[r(f(g.value.versionName),1)]),_:1}),a(V,{label:"版本号"},{default:t(()=>[r(f(g.value.versionCode),1)]),_:1}),a(V,{label:"文件大小"},{default:t(()=>[r(f(fe(g.value.fileSize)),1)]),_:1}),a(V,{label:"最小SDK版本"},{default:t(()=>[r(f(g.value.minSdkVersion),1)]),_:1})]),_:1})]),_:1})):T("",!0),a(i,{label:"选择证书",prop:"certificateId"},{default:t(()=>[a(K,{modelValue:s.certificateId,"onUpdate:modelValue":e[6]||(e[6]=o=>s.certificateId=o),placeholder:"请选择Android证书",style:{width:"100%"}},{default:t(()=>[(w(!0),h(Te,null,xe(B.value,o=>(w(),C(I,{key:o.id,label:o.name,value:o.id},{default:t(()=>[k("span",null,f(o.name),1),k("span",fa,f(o.description),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"签名版本"},{default:t(()=>[a(Ce,{modelValue:s.signatureVersion,"onUpdate:modelValue":e[7]||(e[7]=o=>s.signatureVersion=o)},{default:t(()=>[a(L,{label:"v1"},{default:t(()=>e[32]||(e[32]=[r("V1签名",-1)])),_:1,__:[32]}),a(L,{label:"v2"},{default:t(()=>e[33]||(e[33]=[r("V2签名",-1)])),_:1,__:[33]}),a(L,{label:"v1+v2"},{default:t(()=>e[34]||(e[34]=[r("V1+V2签名",-1)])),_:1,__:[34]})]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"应用名称"},{default:t(()=>[a(d,{modelValue:s.appName,"onUpdate:modelValue":e[8]||(e[8]=o=>s.appName=o),placeholder:"留空则使用原应用名称"},null,8,["modelValue"])]),_:1}),a(i,{label:"包名"},{default:t(()=>[a(d,{modelValue:s.packageName,"onUpdate:modelValue":e[9]||(e[9]=o=>s.packageName=o),placeholder:"留空则使用原包名"},null,8,["modelValue"])]),_:1}),a(i,{label:"版本名称"},{default:t(()=>[a(d,{modelValue:s.versionName,"onUpdate:modelValue":e[10]||(e[10]=o=>s.versionName=o),placeholder:"留空则使用原版本名称"},null,8,["modelValue"])]),_:1}),a(i,{label:"版本号"},{default:t(()=>[a(O,{modelValue:s.versionCode,"onUpdate:modelValue":e[11]||(e[11]=o=>s.versionCode=o),min:1,placeholder:"留空则使用原版本号",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(i,{label:"回调URL"},{default:t(()=>[a(d,{modelValue:s.callbackUrl,"onUpdate:modelValue":e[12]||(e[12]=o=>s.callbackUrl=o),placeholder:"任务完成后的回调地址"},null,8,["modelValue"])]),_:1}),a(i,{label:"任务描述"},{default:t(()=>[a(d,{modelValue:s.description,"onUpdate:modelValue":e[13]||(e[13]=o=>s.description=o),type:"textarea",placeholder:"任务描述信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(G,{modelValue:E.value,"onUpdate:modelValue":e[18]||(e[18]=o=>E.value=o),title:"清理过期任务",width:"400px"},{footer:t(()=>[k("div",ga,[a(p,{onClick:e[17]||(e[17]=o=>E.value=!1)},{default:t(()=>e[37]||(e[37]=[r("取消",-1)])),_:1,__:[37]}),a(p,{type:"primary",onClick:ue,loading:P.value},{default:t(()=>e[38]||(e[38]=[r("确认清理",-1)])),_:1,__:[38]},8,["loading"])])]),default:t(()=>[a(A,{model:D,"label-width":"120px"},{default:t(()=>[a(i,{label:"保留天数"},{default:t(()=>[a(O,{modelValue:D.daysToKeep,"onUpdate:modelValue":e[16]||(e[16]=o=>D.daysToKeep=o),min:1,max:365},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ma=la(va,[["__scopeId","data-v-8f93e9a3"]]);export{Ma as default};
