import{p as y,N as C,V as re,o as R,e as ie,f as a,w as l,D as g,O as ne,a2 as de,B as r,y as pe,a as ue,h as V,t as p,A,C as j,Q as me,R as ce,Z as fe,ab as _e,S as ge,X as we,U as ve,_ as be,a0 as ye,a5 as ke,ac as Ce,ad as Ve,ae as he,a8 as xe}from"./index-df968ec9.js";/* empty css                   *//* empty css                             *//* empty css                   *//* empty css                    *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                *//* empty css               */import{_ as De}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                       */import{e as Ee,f as Pe,h as Te,i as ze,j as Se}from"./certificate-8c453a22.js";import"./request-5c3d6a99.js";const Ue={class:"app-container"},Fe={class:"pagination-container"},Be={class:"dialog-footer"},Me={__name:"index",setup(Re){const h=y(!1),x=y(!1),D=y([]),n=y({}),d=C({name:"",alias:"",createTimeStart:"",createTimeEnd:""}),v=y([]),m=C({page:1,size:10,total:0}),k=C({visible:!1}),E=C({visible:!1}),o=C({name:"",storePassword:"",alias:"",keyPassword:"",file:null,description:""}),P=y(null),T=y(null),L={name:[{required:!0,message:"请输入证书名称",trigger:"blur"}],storePassword:[{required:!0,message:"请输入密钥库密码",trigger:"blur"}],alias:[{required:!0,message:"请输入密钥别名",trigger:"blur"}],keyPassword:[{required:!0,message:"请输入密钥密码",trigger:"blur"}],file:[{required:!0,message:"请选择证书文件",trigger:"change"}]},w=async()=>{h.value=!0;try{const s={page:m.page,size:m.size,name:d.name,alias:d.alias,createTimeStart:d.createTimeStart,createTimeEnd:d.createTimeEnd},e=await Ee(s);e.code===200&&e.data?(D.value=e.data.records||[],m.total=e.data.total||0):(D.value=[],m.total=0,console.error("获取Android证书列表失败:",e.message))}catch{g.error("获取证书列表失败")}finally{h.value=!1}},q=()=>{v.value&&v.value.length===2?(d.createTimeStart=v.value[0],d.createTimeEnd=v.value[1]):(d.createTimeStart="",d.createTimeEnd=""),m.page=1,w()},N=()=>{d.name="",d.alias="",d.createTimeStart="",d.createTimeEnd="",v.value=[],m.page=1,w()},I=()=>{w()},Y=s=>{m.size=s,m.page=1,w()},$=s=>{m.page=s,w()},H=()=>{k.visible=!0,S()},S=()=>{o.name="",o.storePassword="",o.alias="",o.keyPassword="",o.file=null,o.description="",T.value&&T.value.clearFiles()},G=s=>{o.file=s.raw},K=()=>{o.file=null},O=async()=>{P.value&&await P.value.validate(async s=>{if(s){x.value=!0;try{const e=new FormData;e.append("name",o.name),e.append("storePassword",o.storePassword),e.append("alias",o.alias),e.append("keyPassword",o.keyPassword),e.append("file",o.file),e.append("description",o.description||""),await Pe(e),g.success("证书上传成功"),k.visible=!1,w()}catch{g.error("证书上传失败")}finally{x.value=!1}}})},Q=async s=>{try{const e=await Te(s.id);n.value=e.data,E.visible=!0}catch{g.error("获取证书详情失败")}},X=async s=>{try{const{value:e}=await j.prompt("请输入密钥库密码和密钥密码（用逗号分隔）","验证证书",{confirmButtonText:"验证",cancelButtonText:"取消",inputPlaceholder:"密钥库密码,密钥密码"}),[c,i]=e.split(",");if(!c||!i){g.error("请输入正确格式的密码");return}await ze(s.id,{storePassword:c.trim(),keyPassword:i.trim()}),g.success("证书验证成功")}catch(e){e!=="cancel"&&g.error("证书验证失败")}},Z=async s=>{try{await j.confirm("确定要删除这个证书吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Se(s.id),g.success("删除成功"),w()}catch(e){e!=="cancel"&&g.error("删除失败")}},U=s=>{if(!s)return!1;const e=new Date(s),c=new Date,i=e.getTime()-c.getTime(),b=Math.ceil(i/(1e3*60*60*24));return b<=30&&b>=0},J=s=>{if(!s)return"0 B";const e=1024,c=["B","KB","MB","GB"],i=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,i)).toFixed(2))+" "+c[i]};return re(()=>{w()}),(s,e)=>{const c=me,i=ce,b=fe,W=_e,f=ge,ee=we,F=ve,z=ne,_=be,ae=ye,le=ke,te=Ce,B=de,u=Ve,oe=he,se=xe;return R(),ie("div",Ue,[a(z,{class:"search-card"},{default:l(()=>[a(F,{model:d,"label-width":"80px",class:"search-form"},{default:l(()=>[a(ee,{gutter:20},{default:l(()=>[a(b,{span:6},{default:l(()=>[a(i,{label:"证书名称"},{default:l(()=>[a(c,{modelValue:d.name,"onUpdate:modelValue":e[0]||(e[0]=t=>d.name=t),placeholder:"请输入证书名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:l(()=>[a(i,{label:"密钥别名"},{default:l(()=>[a(c,{modelValue:d.alias,"onUpdate:modelValue":e[1]||(e[1]=t=>d.alias=t),placeholder:"请输入密钥别名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:l(()=>[a(i,{label:"创建时间"},{default:l(()=>[a(W,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:l(()=>[a(i,{label:" ",class:"search-buttons"},{default:l(()=>[a(f,{type:"primary",onClick:q,icon:"Search"},{default:l(()=>e[13]||(e[13]=[r("搜索",-1)])),_:1,__:[13]}),a(f,{onClick:N,icon:"Refresh"},{default:l(()=>e[14]||(e[14]=[r("重置",-1)])),_:1,__:[14]})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(z,{class:"operation-card"},{default:l(()=>[a(f,{type:"primary",onClick:H,icon:"Upload"},{default:l(()=>e[15]||(e[15]=[r("上传证书",-1)])),_:1,__:[15]}),a(f,{type:"success",onClick:I,icon:"Refresh"},{default:l(()=>e[16]||(e[16]=[r("刷新",-1)])),_:1,__:[16]})]),_:1}),a(z,null,{default:l(()=>[pe((R(),ue(ae,{data:D.value,style:{width:"100%"}},{default:l(()=>[a(_,{prop:"name",label:"证书名称",width:"200"}),a(_,{prop:"alias",label:"密钥别名",width:"150"}),a(_,{prop:"keySize",label:"密钥长度",width:"100"}),a(_,{prop:"algorithm",label:"算法",width:"120"}),a(_,{prop:"issuer",label:"颁发者",width:"200","show-overflow-tooltip":""}),a(_,{prop:"subject",label:"主题",width:"200","show-overflow-tooltip":""}),a(_,{prop:"expiryDate",label:"过期时间",width:"120"},{default:l(t=>[V("span",{class:A({"text-danger":U(t.row.expiryDate)})},p(t.row.expiryDate),3)]),_:1}),a(_,{prop:"description",label:"描述","show-overflow-tooltip":""}),a(_,{prop:"createTime",label:"创建时间",width:"180"}),a(_,{label:"操作",width:"200",fixed:"right"},{default:l(t=>[a(f,{type:"primary",size:"small",onClick:M=>Q(t.row)},{default:l(()=>e[17]||(e[17]=[r("详情",-1)])),_:2,__:[17]},1032,["onClick"]),a(f,{type:"warning",size:"small",onClick:M=>X(t.row)},{default:l(()=>e[18]||(e[18]=[r("验证",-1)])),_:2,__:[18]},1032,["onClick"]),a(f,{type:"danger",size:"small",onClick:M=>Z(t.row)},{default:l(()=>e[19]||(e[19]=[r("删除",-1)])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,h.value]]),V("div",Fe,[a(le,{"current-page":m.page,"onUpdate:currentPage":e[3]||(e[3]=t=>m.page=t),"page-size":m.size,"onUpdate:pageSize":e[4]||(e[4]=t=>m.size=t),"page-sizes":[10,20,50,100],total:m.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Y,onCurrentChange:$},null,8,["current-page","page-size","total"])])]),_:1}),a(B,{modelValue:k.visible,"onUpdate:modelValue":e[11]||(e[11]=t=>k.visible=t),title:"上传Android证书",width:"600px",onClose:S},{footer:l(()=>[V("div",Be,[a(f,{onClick:e[10]||(e[10]=t=>k.visible=!1)},{default:l(()=>e[22]||(e[22]=[r("取消",-1)])),_:1,__:[22]}),a(f,{type:"primary",onClick:O,loading:x.value},{default:l(()=>e[23]||(e[23]=[r("上传",-1)])),_:1,__:[23]},8,["loading"])])]),default:l(()=>[a(F,{ref_key:"uploadFormRef",ref:P,model:o,rules:L,"label-width":"100px"},{default:l(()=>[a(i,{label:"证书名称",prop:"name"},{default:l(()=>[a(c,{modelValue:o.name,"onUpdate:modelValue":e[5]||(e[5]=t=>o.name=t),placeholder:"请输入证书名称"},null,8,["modelValue"])]),_:1}),a(i,{label:"密钥库密码",prop:"storePassword"},{default:l(()=>[a(c,{modelValue:o.storePassword,"onUpdate:modelValue":e[6]||(e[6]=t=>o.storePassword=t),type:"password",placeholder:"请输入密钥库密码","show-password":""},null,8,["modelValue"])]),_:1}),a(i,{label:"密钥别名",prop:"alias"},{default:l(()=>[a(c,{modelValue:o.alias,"onUpdate:modelValue":e[7]||(e[7]=t=>o.alias=t),placeholder:"请输入密钥别名"},null,8,["modelValue"])]),_:1}),a(i,{label:"密钥密码",prop:"keyPassword"},{default:l(()=>[a(c,{modelValue:o.keyPassword,"onUpdate:modelValue":e[8]||(e[8]=t=>o.keyPassword=t),type:"password",placeholder:"请输入密钥密码","show-password":""},null,8,["modelValue"])]),_:1}),a(i,{label:"证书文件",prop:"file"},{default:l(()=>[a(te,{ref_key:"uploadRef",ref:T,"auto-upload":!1,"show-file-list":!0,limit:1,accept:".jks,.keystore",onChange:G,onRemove:K},{tip:l(()=>e[21]||(e[21]=[V("div",{class:"upload-tip"},"支持 .jks/.keystore 格式证书文件",-1)])),default:l(()=>[a(f,{type:"primary",icon:"Upload"},{default:l(()=>e[20]||(e[20]=[r("选择文件",-1)])),_:1,__:[20]})]),_:1},512)]),_:1}),a(i,{label:"描述"},{default:l(()=>[a(c,{modelValue:o.description,"onUpdate:modelValue":e[9]||(e[9]=t=>o.description=t),type:"textarea",rows:3,placeholder:"请输入证书描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(B,{modelValue:E.visible,"onUpdate:modelValue":e[12]||(e[12]=t=>E.visible=t),title:"证书详情",width:"700px"},{default:l(()=>[a(oe,{column:2,border:""},{default:l(()=>[a(u,{label:"证书名称"},{default:l(()=>[r(p(n.value.name),1)]),_:1}),a(u,{label:"密钥别名"},{default:l(()=>[r(p(n.value.alias),1)]),_:1}),a(u,{label:"密钥长度"},{default:l(()=>[r(p(n.value.keySize),1)]),_:1}),a(u,{label:"算法"},{default:l(()=>[r(p(n.value.algorithm),1)]),_:1}),a(u,{label:"序列号"},{default:l(()=>[r(p(n.value.serialNumber),1)]),_:1}),a(u,{label:"指纹(SHA1)"},{default:l(()=>[r(p(n.value.sha1Fingerprint),1)]),_:1}),a(u,{label:"指纹(SHA256)"},{default:l(()=>[r(p(n.value.sha256Fingerprint),1)]),_:1}),a(u,{label:"指纹(MD5)"},{default:l(()=>[r(p(n.value.md5Fingerprint),1)]),_:1}),a(u,{label:"颁发者",span:2},{default:l(()=>[r(p(n.value.issuer),1)]),_:1}),a(u,{label:"主题",span:2},{default:l(()=>[r(p(n.value.subject),1)]),_:1}),a(u,{label:"生效时间"},{default:l(()=>[r(p(n.value.validFrom),1)]),_:1}),a(u,{label:"过期时间"},{default:l(()=>[V("span",{class:A({"text-danger":U(n.value.expiryDate)})},p(n.value.expiryDate),3)]),_:1}),a(u,{label:"创建时间"},{default:l(()=>[r(p(n.value.createTime),1)]),_:1}),a(u,{label:"文件大小"},{default:l(()=>[r(p(J(n.value.fileSize)),1)]),_:1}),a(u,{label:"描述",span:2},{default:l(()=>[r(p(n.value.description||"无"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},ea=De(Me,[["__scopeId","data-v-260abf7a"]]);export{ea as default};
