import{a1 as n,D as i}from"./index-df968ec9.js";import{s as r}from"./request-5c3d6a99.js";const l=n("auth",{state:()=>({token:localStorage.getItem("token")||"",userInfo:JSON.parse(localStorage.getItem("userInfo")||"{}"),isLoggedIn:!!localStorage.getItem("token")}),getters:{hasToken:e=>!!e.token,currentUser:e=>e.userInfo},actions:{async login(e){try{const t=await r({url:"/api/auth/login",method:"post",data:e}),{data:s}=t,a=s.token,o={id:s.id,username:s.username,nickname:s.nickname,email:s.email,phone:s.phone,avatar:s.avatar,roles:s.roles||[]};return this.token=a,this.userInfo=o,this.isLoggedIn=!0,localStorage.setItem("token",a),localStorage.setItem("userInfo",JSON.stringify(o)),{success:!0,data:o}}catch(t){return i.error(t.message||"登录失败"),{success:!1,message:t.message}}},async logout(){try{this.token&&await r({url:"/api/auth/logout",method:"post",headers:{Authorization:`Bearer ${this.token}`}})}catch(e){console.error("登出请求失败:",e)}finally{this.token="",this.userInfo={},this.isLoggedIn=!1,localStorage.removeItem("token"),localStorage.removeItem("userInfo")}},async getUserInfo(){try{if(!this.token)throw new Error("未登录");const t=(await r({url:"/api/auth/userinfo",method:"get",headers:{Authorization:`Bearer ${this.token}`}})).data;return this.userInfo=t,localStorage.setItem("userInfo",JSON.stringify(t)),{success:!0,data:t}}catch(e){return this.logout(),{success:!1,message:e.message}}}}});export{l as u};
