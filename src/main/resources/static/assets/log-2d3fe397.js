import{N,p as _,V as J,o as w,e as K,f as e,w as l,h as E,D as C,C as ee,S as le,O as te,a2 as ae,B as r,y as oe,a as V,t as p,Y as T,i as B,a3 as se,a4 as ne,R as re,Z as ie,Q as ce,ab as ue,X as de,U as pe,$ as _e,_ as me,a0 as fe,a5 as ve,ad as ge,ae as ye,a8 as be}from"./index-df968ec9.js";/* empty css                   *//* empty css                   *//* empty css                             *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                *//* empty css               */import{_ as he}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                       */import{f as O}from"./validate-ec87a090.js";import{s as A}from"./request-5c3d6a99.js";function we(x){return A({url:"/api/system/logs",method:"get",params:x})}function Ee(){return A({url:"/api/system/logs/clear",method:"delete"})}const ke={class:"app-container"},Re={class:"table-operations"},Ce={class:"table-actions"},Ve={class:"pagination-container"},xe={class:"exception-stack"},ze={__name:"log",setup(x){const c=N({level:"",keyword:""}),u=_([]),i=N({current:1,size:20}),g=_([]),y=_(0),k=_(!1),R=_(!1),n=_(null),d=async()=>{k.value=!0;try{const o={current:i.current,size:i.size,level:c.level,keyword:c.keyword};u.value&&u.value.length===2&&(o.startTime=u.value[0],o.endTime=u.value[1]);const t=await we(o);console.log("日志API响应:",t);let s=t.data;t.code===200&&t.data&&(s=t.data),s&&typeof s=="object"?(g.value=Array.isArray(s.records)?s.records:Array.isArray(s.list)?s.list:[],y.value=s.total||s.count||0):(console.warn("日志API返回的数据格式不正确:",s),g.value=[],y.value=0)}catch(o){console.error("获取日志列表失败:",o),C.error("获取日志列表失败"),g.value=[],y.value=0}finally{k.value=!1}},I=()=>{i.current=1,d()},L=()=>{Object.keys(c).forEach(o=>{c[o]=""}),u.value=[],i.current=1,d()},S=()=>{d()},U=()=>{ee.confirm("确定要清空所有日志吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ee(),C.success("日志已清空"),d()}catch(o){console.error("清空日志失败:",o),C.error("清空日志失败")}}).catch(()=>{})},F=o=>{n.value=o,R.value=!0},M=o=>{i.size=o,d()},P=o=>{i.current=o,d()};return J(()=>{d()}),(o,t)=>{const s=se,Y=ne,b=re,h=ie,W=ce,j=ue,m=le,$=de,G=pe,z=te,D=_e,f=me,Q=fe,X=ve,v=ge,Z=ye,q=ae,H=be;return w(),K("div",ke,[e(z,{class:"search-card"},{default:l(()=>[e(G,{model:c,"label-width":"80px",class:"search-form"},{default:l(()=>[e($,{gutter:20},{default:l(()=>[e(h,{span:6},{default:l(()=>[e(b,{label:"日志级别"},{default:l(()=>[e(Y,{modelValue:c.level,"onUpdate:modelValue":t[0]||(t[0]=a=>c.level=a),placeholder:"请选择日志级别",clearable:"",style:{width:"100%"}},{default:l(()=>[e(s,{label:"INFO",value:"INFO"}),e(s,{label:"WARN",value:"WARN"}),e(s,{label:"ERROR",value:"ERROR"}),e(s,{label:"DEBUG",value:"DEBUG"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(h,{span:6},{default:l(()=>[e(b,{label:"关键词"},{default:l(()=>[e(W,{modelValue:c.keyword,"onUpdate:modelValue":t[1]||(t[1]=a=>c.keyword=a),placeholder:"请输入关键词",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:6},{default:l(()=>[e(b,{label:"时间范围"},{default:l(()=>[e(j,{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=a=>u.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:6},{default:l(()=>[e(b,{label:" ",class:"search-buttons"},{default:l(()=>[e(m,{type:"primary",onClick:I,icon:"Search"},{default:l(()=>t[6]||(t[6]=[r("搜索",-1)])),_:1,__:[6]}),e(m,{onClick:L,icon:"Refresh"},{default:l(()=>t[7]||(t[7]=[r("重置",-1)])),_:1,__:[7]})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),E("div",Re,[e(m,{type:"success",onClick:S},{default:l(()=>t[8]||(t[8]=[r("刷新",-1)])),_:1,__:[8]}),e(m,{type:"danger",onClick:U},{default:l(()=>t[9]||(t[9]=[r("清空日志",-1)])),_:1,__:[9]})]),e(z,{class:"table-card"},{default:l(()=>[oe((w(),V(Q,{data:g.value,stripe:"",class:"log-table","max-height":"600"},{default:l(()=>[e(f,{prop:"level",label:"级别",width:"80"},{default:l(({row:a})=>[e(D,{type:a.level==="ERROR"?"danger":a.level==="WARN"?"warning":a.level==="INFO"?"success":"info"},{default:l(()=>[r(p(a.level),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"logger",label:"记录器","min-width":"200","show-overflow-tooltip":""}),e(f,{prop:"message",label:"消息","min-width":"300","show-overflow-tooltip":""}),e(f,{prop:"createTime",label:"时间",width:"180"},{default:l(({row:a})=>[r(p(T(O)(a.createTime)),1)]),_:1}),e(f,{label:"操作",width:"120",fixed:"right"},{default:l(({row:a})=>[E("div",Ce,[e(m,{type:"primary",size:"small",onClick:De=>F(a)},{default:l(()=>t[10]||(t[10]=[r(" 详情 ",-1)])),_:2,__:[10]},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[H,k.value]]),E("div",Ve,[e(X,{"current-page":i.current,"onUpdate:currentPage":t[3]||(t[3]=a=>i.current=a),"page-size":i.size,"onUpdate:pageSize":t[4]||(t[4]=a=>i.size=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:y.value,onSizeChange:M,onCurrentChange:P},null,8,["current-page","page-size","total"])])]),_:1}),e(q,{modelValue:R.value,"onUpdate:modelValue":t[5]||(t[5]=a=>R.value=a),title:"日志详情",width:"70%"},{default:l(()=>[n.value?(w(),V(Z,{key:0,column:1,border:""},{default:l(()=>[e(v,{label:"时间"},{default:l(()=>[r(p(T(O)(n.value.createTime)),1)]),_:1}),e(v,{label:"级别"},{default:l(()=>[e(D,{type:n.value.level==="ERROR"?"danger":n.value.level==="WARN"?"warning":n.value.level==="INFO"?"success":"info"},{default:l(()=>[r(p(n.value.level),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"记录器"},{default:l(()=>[r(p(n.value.logger),1)]),_:1}),e(v,{label:"消息"},{default:l(()=>[r(p(n.value.message),1)]),_:1}),n.value.exception?(w(),V(v,{key:0,label:"异常堆栈"},{default:l(()=>[E("pre",xe,p(n.value.exception),1)]),_:1})):B("",!0)]),_:1})):B("",!0)]),_:1},8,["modelValue"])])}}},Ge=he(ze,[["__scopeId","data-v-8139c2f3"]]);export{Ge as default};
