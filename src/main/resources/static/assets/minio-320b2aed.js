import{p,N as Z,V as J,o as m,e as I,f as t,w as a,D as r,O as P,a2 as Q,h as l,B as n,A as O,Y as c,t as u,a as B,i as W,y as ee,C as te,S as ae,E as se,Z as le,$ as oe,X as ne,ai as ie,aj as de,ak as re,_ as ue,a0 as ce,ac as _e,a8 as pe,al as fe,am as me,an as ve,ao as ge,ap as be,aq as ye,ar as ke,ag as we}from"./index-df968ec9.js";/* empty css                   *//* empty css                   *//* empty css                    *//* empty css                        *//* empty css                   *//* empty css               *//* empty css                *//* empty css               */import{_ as Ee}from"./_plugin-vue_export-helper-8da67cfc.js";import{s as C}from"./request-5c3d6a99.js";const he={class:"minio-container"},Me={class:"card-header"},xe={class:"status-content"},Be={class:"status-item"},Ce={class:"status-item"},ze={class:"status-value"},Ne={class:"status-item"},Ie={class:"status-item"},Oe={class:"status-value"},Ve={key:0,class:"error-message"},De={class:"action-content"},Te={class:"card-header"},Ue={class:"file-name"},Se={class:"etag"},$e="/api/file/upload",je={__name:"minio",setup(Le){const y=p(!1),k=p(!1),v=p(!1),w=p(!1),V=p(null),o=Z({connected:!1,endpoint:"",bucketName:"",bucketExists:!1,fileCount:0,error:""}),f=p([]),D={Authorization:`Bearer ${localStorage.getItem("token")}`},E=async()=>{y.value=!0;try{const s=await C.get("/api/minio/health");Object.assign(o,s.data),o.error="",o.connected?r.success("MinIO连接正常"):r.warning("MinIO连接异常")}catch(s){o.connected=!1,o.error=s.message||"连接失败",r.error("检查MinIO状态失败: "+s.message)}finally{y.value=!1}},T=async()=>{try{await te.confirm("确定要创建MinIO存储桶吗？","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.value=!0;const s=await C.post("/api/minio/create-bucket");r.success(s.data),await E()}catch(s){s!=="cancel"&&r.error("创建存储桶失败: "+s.message)}finally{k.value=!1}},U=()=>{var e;const s=((e=o.endpoint)==null?void 0:e.replace(":9000",":9001"))||"http://localhost:9001";window.open(s,"_blank")},h=async()=>{v.value=!0;try{const s=await C.get("/api/minio/files");f.value=s.data||[],r.success(`加载了 ${f.value.length} 个文件`)}catch(s){r.error("加载文件列表失败: "+s.message),f.value=[]}finally{v.value=!1}},S=()=>{w.value=!0},$=s=>s.size>10*1024*1024?(r.error("文件大小不能超过10MB"),!1):!0,j=(s,e)=>{r.success(`文件 ${e.name} 上传成功`),h()},L=(s,e)=>{r.error(`文件 ${e.name} 上传失败: ${s.message}`)},A=s=>{if(!s)return"0 B";const e=1024,_=["B","KB","MB","GB"],i=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,i)).toFixed(2))+" "+_[i]},F=s=>s?new Date(s).toLocaleString("zh-CN"):"-";return J(()=>{E(),h()}),(s,e)=>{const _=ae,i=se,g=le,M=oe,R=ne,H=ie,x=P,q=de,z=re,b=ue,G=ce,K=_e,X=Q,Y=pe;return m(),I("div",he,[t(x,{class:"status-card"},{header:a(()=>[l("div",Me,[e[2]||(e[2]=l("span",null,"MinIO状态",-1)),t(_,{type:"primary",size:"small",onClick:E,loading:y.value},{default:a(()=>e[1]||(e[1]=[n(" 刷新状态 ",-1)])),_:1,__:[1]},8,["loading"])])]),default:a(()=>[l("div",xe,[t(R,{gutter:20},{default:a(()=>[t(g,{span:6},{default:a(()=>[l("div",Be,[e[3]||(e[3]=l("div",{class:"status-label"},"连接状态",-1)),l("div",{class:O(["status-value",o.connected?"success":"error"])},[t(i,null,{default:a(()=>[t(c(fe))]),_:1}),n(" "+u(o.connected?"已连接":"未连接"),1)],2)])]),_:1}),t(g,{span:6},{default:a(()=>[l("div",Ce,[e[4]||(e[4]=l("div",{class:"status-label"},"服务地址",-1)),l("div",ze,u(o.endpoint||"-"),1)])]),_:1}),t(g,{span:6},{default:a(()=>[l("div",Ne,[e[7]||(e[7]=l("div",{class:"status-label"},"存储桶",-1)),l("div",{class:O(["status-value",o.bucketExists?"success":"warning"])},[t(i,null,{default:a(()=>[t(c(me))]),_:1}),n(" "+u(o.bucketName||"-")+" ",1),o.bucketExists?(m(),B(M,{key:0,type:"success",size:"small"},{default:a(()=>e[5]||(e[5]=[n("存在",-1)])),_:1,__:[5]})):(m(),B(M,{key:1,type:"warning",size:"small"},{default:a(()=>e[6]||(e[6]=[n("不存在",-1)])),_:1,__:[6]}))],2)])]),_:1}),t(g,{span:6},{default:a(()=>[l("div",Ie,[e[8]||(e[8]=l("div",{class:"status-label"},"文件数量",-1)),l("div",Oe,[t(i,null,{default:a(()=>[t(c(ve))]),_:1}),n(" "+u(o.fileCount||0)+" 个文件 ",1)])])]),_:1})]),_:1}),o.error?(m(),I("div",Ve,[t(H,{title:o.error,type:"error","show-icon":""},null,8,["title"])])):W("",!0)])]),_:1}),t(x,{class:"action-card"},{header:a(()=>e[9]||(e[9]=[l("div",{class:"card-header"},[l("span",null,"操作面板")],-1)])),default:a(()=>[l("div",De,[t(q,{wrap:""},{default:a(()=>[t(_,{type:"primary",onClick:T,loading:k.value,disabled:o.bucketExists},{default:a(()=>[t(i,null,{default:a(()=>[t(c(ge))]),_:1}),e[10]||(e[10]=n(" 创建存储桶 ",-1))]),_:1,__:[10]},8,["loading","disabled"]),t(_,{type:"info",onClick:U},{default:a(()=>[t(i,null,{default:a(()=>[t(c(be))]),_:1}),e[11]||(e[11]=n(" 打开MinIO控制台 ",-1))]),_:1,__:[11]}),t(_,{type:"success",onClick:h,loading:v.value},{default:a(()=>[t(i,null,{default:a(()=>[t(c(ye))]),_:1}),e[12]||(e[12]=n(" 刷新文件列表 ",-1))]),_:1,__:[12]},8,["loading"]),t(_,{type:"warning",onClick:S},{default:a(()=>[t(i,null,{default:a(()=>[t(c(ke))]),_:1}),e[13]||(e[13]=n(" 测试上传 ",-1))]),_:1,__:[13]})]),_:1})])]),_:1}),t(x,{class:"files-card"},{header:a(()=>[l("div",Te,[e[14]||(e[14]=l("span",null,"文件列表",-1)),t(M,{type:"info"},{default:a(()=>[n(u(f.value.length)+" 个文件",1)]),_:1})])]),default:a(()=>[ee((m(),B(G,{data:f.value,"empty-text":"暂无文件"},{default:a(()=>[t(b,{prop:"objectName",label:"文件名","min-width":"200"},{default:a(({row:d})=>[t(z,{content:d.objectName,placement:"top"},{default:a(()=>[l("span",Ue,u(d.objectName),1)]),_:2},1032,["content"])]),_:1}),t(b,{prop:"size",label:"大小",width:"120"},{default:a(({row:d})=>[n(u(A(d.size)),1)]),_:1}),t(b,{prop:"lastModified",label:"修改时间",width:"180"},{default:a(({row:d})=>[n(u(F(d.lastModified)),1)]),_:1}),t(b,{prop:"etag",label:"ETag",width:"120"},{default:a(({row:d})=>[t(z,{content:d.etag,placement:"top"},{default:a(()=>{var N;return[l("span",Se,u((N=d.etag)==null?void 0:N.substring(0,8))+"...",1)]}),_:2},1032,["content"])]),_:1})]),_:1},8,["data"])),[[Y,v.value]])]),_:1}),t(X,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=d=>w.value=d),title:"测试文件上传",width:"500px"},{default:a(()=>[t(K,{ref_key:"uploadRef",ref:V,action:$e,headers:D,"on-success":j,"on-error":L,"before-upload":$,drag:"",multiple:""},{tip:a(()=>e[15]||(e[15]=[l("div",{class:"el-upload__tip"}," 支持任意格式文件，用于测试MinIO上传功能 ",-1)])),default:a(()=>[t(i,{class:"el-icon--upload"},{default:a(()=>[t(c(we))]),_:1}),e[16]||(e[16]=l("div",{class:"el-upload__text"},[n(" 将文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1,__:[16]},512)]),_:1},8,["modelValue"])])}}},Pe=Ee(je,[["__scopeId","data-v-05ad9417"]]);export{Pe as default};
