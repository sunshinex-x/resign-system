import{N as D,p as c,V as re,o as F,e as ne,f as l,w as t,h as k,D as u,S as de,O as ie,a2 as ue,B as r,y as ce,a as me,t as T,Y as pe,C as A,Q as _e,R as fe,Z as ve,a3 as ye,a4 as be,X as ge,U as Ce,_ as ke,$ as Ve,a0 as he,a6 as Ee,a7 as we,a9 as Ne,a8 as Te}from"./index-df968ec9.js";/* empty css                   *//* empty css                        *//* empty css                   *//* empty css                 *//* empty css                   *//* empty css               *//* empty css                *//* empty css                 *//* empty css               */import{_ as xe}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                  */import{f as Re}from"./validate-ec87a090.js";import{a as $e,i as Be,m as Pe,f as I,h as Se,e as Ue,s as De}from"./user-c8e6b2be.js";import"./request-5c3d6a99.js";const Fe={class:"app-container"},Ae={class:"table-operations"},Ie={class:"table-actions"},Ke={class:"dialog-footer"},Le={class:"dialog-footer"},Oe={__name:"role",setup(ze){const d=D({roleName:"",roleCode:"",status:""}),b=c([]),V=c(!1),_=c(!1),h=c(""),g=c(!1),v=c(null),y=c(!1),E=c(null),w=c(null),x=c([]),n=D({id:null,roleName:"",roleCode:"",description:"",status:1}),K={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色编码",trigger:"blur"},{pattern:/^[A-Z_]+$/,message:"角色编码只能包含大写字母和下划线",trigger:"blur"}]},L={children:"children",label:"name"},R=c([]),O=()=>{f()},z=()=>{Object.keys(d).forEach(o=>{d[o]=""}),f()},f=async()=>{V.value=!0;try{const o={roleName:d.roleName,roleCode:d.roleCode,status:d.status},e=await $e(o);console.log("API响应:",e);let s=e.data;e.code===200&&e.data&&(s=e.data.records||e.data),Array.isArray(s)?b.value=s:(console.warn("API返回的数据不是数组格式:",s),b.value=[])}catch(o){console.error("获取角色列表失败:",o),u.error("获取角色列表失败"),b.value=[]}finally{V.value=!1}},M=()=>{f()},j=()=>{h.value="新增角色",g.value=!1,J(),_.value=!0},q=o=>{h.value="编辑角色",g.value=!0,Object.assign(n,o),_.value=!0},Z=async o=>{w.value=o;try{const{data:e}=await Be();R.value=e||[];const{data:s}=await Pe(o.id);x.value=s||[],y.value=!0}catch(e){console.error("获取权限数据失败:",e),u.error("获取权限数据失败")}},G=o=>{const e=o.status===1?"禁用":"启用";A.confirm(`确定要${e}角色 "${o.roleName}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const s=o.status===1?0:1;await I(o.id,{...o,status:s}),o.status=s,u.success(`${e}成功`)}catch(s){console.error(`${e}角色失败:`,s),u.error(`${e}失败`)}}).catch(()=>{})},H=o=>{if(o.roleCode==="SUPER_ADMIN"){u.warning("超级管理员角色不能删除");return}A.confirm(`确定要删除角色 "${o.roleName}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Se(o.id),u.success("删除成功"),f()}catch(e){console.error("删除角色失败:",e),u.error("删除失败")}}).catch(()=>{})},Q=async()=>{v.value&&await v.value.validate(async o=>{if(o)try{g.value?(await I(n.id,n),u.success("编辑成功")):(await Ue(n),u.success("新增成功")),_.value=!1,f()}catch(e){console.error("保存角色失败:",e),u.error("保存失败")}})},X=(o,e)=>{},Y=async()=>{try{const o=E.value.getCheckedKeys(),e=E.value.getHalfCheckedKeys(),s=[...o,...e];await De(w.value.id,s),u.success(`已为角色 "${w.value.roleName}" 配置 ${s.length} 个权限`),y.value=!1}catch(o){console.error("保存权限配置失败:",o),u.error("保存权限配置失败")}},J=()=>{Object.assign(n,{id:null,roleName:"",roleCode:"",description:"",status:1}),v.value&&v.value.resetFields()};return re(()=>{f()}),(o,e)=>{const s=_e,m=fe,C=ve,$=ye,W=be,i=de,ee=ge,B=Ce,P=ie,p=ke,le=Ve,te=he,S=Ee,ae=we,U=ue,oe=Ne,se=Te;return F(),ne("div",Fe,[l(P,{class:"search-card"},{default:t(()=>[l(B,{model:d,"label-width":"80px",class:"search-form"},{default:t(()=>[l(ee,{gutter:20},{default:t(()=>[l(C,{span:6},{default:t(()=>[l(m,{label:"角色名称"},{default:t(()=>[l(s,{modelValue:d.roleName,"onUpdate:modelValue":e[0]||(e[0]=a=>d.roleName=a),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(C,{span:6},{default:t(()=>[l(m,{label:"角色编码"},{default:t(()=>[l(s,{modelValue:d.roleCode,"onUpdate:modelValue":e[1]||(e[1]=a=>d.roleCode=a),placeholder:"请输入角色编码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(C,{span:6},{default:t(()=>[l(m,{label:"状态"},{default:t(()=>[l(W,{modelValue:d.status,"onUpdate:modelValue":e[2]||(e[2]=a=>d.status=a),placeholder:"请选择状态",clearable:"",style:{width:"100%"}},{default:t(()=>[l($,{label:"启用",value:"1"}),l($,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(C,{span:6},{default:t(()=>[l(m,{label:" ",class:"search-buttons"},{default:t(()=>[l(i,{type:"primary",onClick:O,icon:"Search"},{default:t(()=>e[11]||(e[11]=[r("搜索",-1)])),_:1,__:[11]}),l(i,{onClick:z,icon:"Refresh"},{default:t(()=>e[12]||(e[12]=[r("重置",-1)])),_:1,__:[12]})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),k("div",Ae,[l(i,{type:"primary",onClick:j},{default:t(()=>e[13]||(e[13]=[r("新增角色",-1)])),_:1,__:[13]}),l(i,{type:"success",onClick:M},{default:t(()=>e[14]||(e[14]=[r("刷新",-1)])),_:1,__:[14]})]),l(P,{class:"table-card"},{default:t(()=>[ce((F(),me(te,{data:b.value,stripe:"",class:"role-table"},{default:t(()=>[l(p,{prop:"id",label:"角色ID",width:"80"}),l(p,{prop:"roleName",label:"角色名称","min-width":"150"}),l(p,{prop:"roleCode",label:"角色编码","min-width":"150"}),l(p,{prop:"description",label:"角色描述","min-width":"200","show-overflow-tooltip":""}),l(p,{prop:"status",label:"状态",width:"80"},{default:t(({row:a})=>[l(le,{type:a.status===1?"success":"danger"},{default:t(()=>[r(T(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"createTime",label:"创建时间",width:"160"},{default:t(({row:a})=>[r(T(pe(Re)(a.createTime)),1)]),_:1}),l(p,{label:"操作",width:"280",fixed:"right"},{default:t(({row:a})=>[k("div",Ie,[l(i,{type:"primary",size:"small",onClick:N=>q(a)},{default:t(()=>e[15]||(e[15]=[r(" 编辑 ",-1)])),_:2,__:[15]},1032,["onClick"]),l(i,{type:"info",size:"small",onClick:N=>Z(a)},{default:t(()=>e[16]||(e[16]=[r(" 权限配置 ",-1)])),_:2,__:[16]},1032,["onClick"]),l(i,{type:a.status===1?"warning":"success",size:"small",onClick:N=>G(a)},{default:t(()=>[r(T(a.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(i,{type:"danger",size:"small",onClick:N=>H(a),disabled:a.id===1},{default:t(()=>e[17]||(e[17]=[r(" 删除 ",-1)])),_:2,__:[17]},1032,["onClick","disabled"])])]),_:1})]),_:1},8,["data"])),[[se,V.value]])]),_:1}),l(U,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value=a),title:h.value,width:"500px"},{footer:t(()=>[k("span",Ke,[l(i,{onClick:e[7]||(e[7]=a=>_.value=!1)},{default:t(()=>e[20]||(e[20]=[r("取消",-1)])),_:1,__:[20]}),l(i,{type:"primary",onClick:Q},{default:t(()=>e[21]||(e[21]=[r("确定",-1)])),_:1,__:[21]})])]),default:t(()=>[l(B,{model:n,rules:K,ref_key:"roleFormRef",ref:v,"label-width":"100px"},{default:t(()=>[l(m,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(s,{modelValue:n.roleName,"onUpdate:modelValue":e[3]||(e[3]=a=>n.roleName=a),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"角色编码",prop:"roleCode"},{default:t(()=>[l(s,{modelValue:n.roleCode,"onUpdate:modelValue":e[4]||(e[4]=a=>n.roleCode=a),placeholder:"请输入角色编码",disabled:g.value},null,8,["modelValue","disabled"])]),_:1}),l(m,{label:"角色描述",prop:"description"},{default:t(()=>[l(s,{modelValue:n.description,"onUpdate:modelValue":e[5]||(e[5]=a=>n.description=a),type:"textarea",rows:"3",placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),l(m,{label:"状态",prop:"status"},{default:t(()=>[l(ae,{modelValue:n.status,"onUpdate:modelValue":e[6]||(e[6]=a=>n.status=a)},{default:t(()=>[l(S,{label:1},{default:t(()=>e[18]||(e[18]=[r("启用",-1)])),_:1,__:[18]}),l(S,{label:0},{default:t(()=>e[19]||(e[19]=[r("禁用",-1)])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(U,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=a=>y.value=a),title:"权限配置",width:"600px"},{footer:t(()=>[k("span",Le,[l(i,{onClick:e[9]||(e[9]=a=>y.value=!1)},{default:t(()=>e[22]||(e[22]=[r("取消",-1)])),_:1,__:[22]}),l(i,{type:"primary",onClick:Y},{default:t(()=>e[23]||(e[23]=[r("保存",-1)])),_:1,__:[23]})])]),default:t(()=>[l(oe,{ref_key:"permissionTreeRef",ref:E,data:R.value,props:L,"show-checkbox":"","node-key":"id","default-checked-keys":x.value,onCheck:X},null,8,["data","default-checked-keys"])]),_:1},8,["modelValue"])])}}},ol=xe(Oe,[["__scopeId","data-v-2a925e88"]]);export{ol as default};
