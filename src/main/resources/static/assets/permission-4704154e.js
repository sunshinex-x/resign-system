import{N as F,p as c,V as se,o as _,e as ne,f as l,w as t,h as D,D as f,S as re,O as ue,a2 as ie,B as r,y as de,a as y,t as w,b as pe,i as E,Y as me,C as N,Q as ce,R as _e,Z as fe,a3 as be,a4 as ye,X as ve,U as ge,_ as Ve,$ as he,E as Ee,a0 as ke,aa as Ce,a6 as xe,a7 as we,a8 as Te}from"./index-df968ec9.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css                   *//* empty css               *//* empty css                *//* empty css               */import{_ as Ue}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                  */import{n as $e,k as L,l as Be,j as De}from"./user-c8e6b2be.js";import{f as Pe}from"./validate-ec87a090.js";import"./request-5c3d6a99.js";const Re={class:"app-container"},Se={class:"table-operations"},Ie={class:"table-actions"},Ae={class:"dialog-footer"},Fe={__name:"permission",setup(Ne){const p=F({name:"",code:"",type:""}),v=c([]),T=c(!1),U=c(null),b=c(!1),k=c(""),C=c(!1),V=c(null),h=c(null),s=F({id:null,parentId:null,name:"",code:"",type:"menu",path:"",icon:"",sort:0,status:1,description:""}),O={name:[{required:!0,message:"请输入权限名称",trigger:"blur"}],code:[{required:!0,message:"请输入权限编码",trigger:"blur"},{pattern:/^[A-Z_:]+$/,message:"权限编码只能包含大写字母、下划线和冒号",trigger:"blur"}],type:[{required:!0,message:"请选择权限类型",trigger:"change"}]},j=()=>{g()},z=()=>{Object.keys(p).forEach(o=>{p[o]=""}),g()},g=async()=>{T.value=!0;try{const o=await $e();console.log("权限API响应:",o);let e=o.data;o.code===200&&o.data&&(e=o.data.list||o.data),Array.isArray(e)?v.value=e:(console.warn("权限API返回的数据不是数组格式:",e),v.value=[])}catch(o){console.error("获取权限列表失败:",o),f.error("获取权限列表失败"),v.value=[]}finally{T.value=!1}},q=()=>{g()},M=()=>{const o=e=>{e.forEach(n=>{U.value.toggleRowExpansion(n,!0),n.children&&n.children.length>0&&o(n.children)})};o(v.value)},Z=()=>{const o=e=>{e.forEach(n=>{U.value.toggleRowExpansion(n,!1),n.children&&n.children.length>0&&o(n.children)})};o(v.value)},G=()=>{k.value="新增权限",C.value=!1,h.value=null,P(),b.value=!0},Q=o=>{k.value="新增子权限",C.value=!1,h.value=o,P(),s.parentId=o.id,b.value=!0},X=o=>{k.value="编辑权限",C.value=!0,h.value=null,Object.assign(s,o),b.value=!0},Y=o=>{const e=o.status===1?"禁用":"启用";N.confirm(`确定要${e}权限 "${o.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const n=o.status===1?0:1;await L(o.id,{...o,status:n}),o.status=n,f.success(`${e}成功`)}catch(n){console.error("更新权限状态失败:",n),f.error(`${e}失败`)}}).catch(()=>{})},H=o=>{N.confirm(`确定要删除权限 "${o.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Be(o.id),f.success("删除成功"),g()}catch(e){console.error("删除权限失败:",e),f.error("删除失败")}}).catch(()=>{})},J=async()=>{V.value&&await V.value.validate(async o=>{if(o)try{C.value?(await L(s.id,s),f.success("编辑成功")):(await De(s),f.success("新增成功")),b.value=!1,g()}catch(e){console.error("保存权限失败:",e),f.error("保存失败")}})},P=()=>{Object.assign(s,{id:null,parentId:null,name:"",code:"",type:"menu",path:"",icon:"",sort:0,status:1,description:""}),V.value&&V.value.resetFields()};return se(()=>{g()}),(o,e)=>{const n=ce,u=_e,x=fe,i=be,$=ye,d=re,K=ve,R=ge,S=ue,m=Ve,I=he,W=Ee,ee=ke,le=Ce,A=xe,te=we,ae=ie,oe=Te;return _(),ne("div",Re,[l(S,{class:"search-card"},{default:t(()=>[l(R,{model:p,"label-width":"80px",class:"search-form"},{default:t(()=>[l(K,{gutter:20},{default:t(()=>[l(x,{span:6},{default:t(()=>[l(u,{label:"权限名称"},{default:t(()=>[l(n,{modelValue:p.name,"onUpdate:modelValue":e[0]||(e[0]=a=>p.name=a),placeholder:"请输入权限名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(x,{span:6},{default:t(()=>[l(u,{label:"权限编码"},{default:t(()=>[l(n,{modelValue:p.code,"onUpdate:modelValue":e[1]||(e[1]=a=>p.code=a),placeholder:"请输入权限编码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(x,{span:6},{default:t(()=>[l(u,{label:"权限类型"},{default:t(()=>[l($,{modelValue:p.type,"onUpdate:modelValue":e[2]||(e[2]=a=>p.type=a),placeholder:"请选择权限类型",clearable:"",style:{width:"100%"}},{default:t(()=>[l(i,{label:"菜单",value:"menu"}),l(i,{label:"按钮",value:"button"}),l(i,{label:"接口",value:"api"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(x,{span:6},{default:t(()=>[l(u,{label:" ",class:"search-buttons"},{default:t(()=>[l(d,{type:"primary",onClick:j,icon:"Search"},{default:t(()=>e[13]||(e[13]=[r("搜索",-1)])),_:1,__:[13]}),l(d,{onClick:z,icon:"Refresh"},{default:t(()=>e[14]||(e[14]=[r("重置",-1)])),_:1,__:[14]})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),D("div",Se,[l(d,{type:"primary",onClick:G},{default:t(()=>e[15]||(e[15]=[r("新增权限",-1)])),_:1,__:[15]}),l(d,{type:"success",onClick:q},{default:t(()=>e[16]||(e[16]=[r("刷新",-1)])),_:1,__:[16]}),l(d,{type:"info",onClick:M},{default:t(()=>e[17]||(e[17]=[r("展开所有",-1)])),_:1,__:[17]}),l(d,{type:"info",onClick:Z},{default:t(()=>e[18]||(e[18]=[r("收起所有",-1)])),_:1,__:[18]})]),l(S,{class:"table-card"},{default:t(()=>[de((_(),y(ee,{ref_key:"permissionTableRef",ref:U,data:v.value,stripe:"",class:"permission-table","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},{default:t(()=>[l(m,{prop:"name",label:"权限名称","min-width":"200"}),l(m,{prop:"code",label:"权限编码","min-width":"200"}),l(m,{prop:"type",label:"权限类型",width:"100"},{default:t(({row:a})=>[l(I,{type:a.type==="menu"?"primary":a.type==="button"?"success":"info"},{default:t(()=>[r(w(a.type==="menu"?"菜单":a.type==="button"?"按钮":"接口"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"path",label:"路径/接口","min-width":"150","show-overflow-tooltip":""}),l(m,{prop:"icon",label:"图标",width:"80"},{default:t(({row:a})=>[a.icon?(_(),y(W,{key:0},{default:t(()=>[(_(),y(pe(a.icon)))]),_:2},1024)):E("",!0)]),_:1}),l(m,{prop:"sort",label:"排序",width:"80"}),l(m,{prop:"status",label:"状态",width:"80"},{default:t(({row:a})=>[l(I,{type:a.status===1?"success":"danger"},{default:t(()=>[r(w(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"createTime",label:"创建时间",width:"160"},{default:t(({row:a})=>[r(w(me(Pe)(a.createTime)),1)]),_:1}),l(m,{label:"操作",width:"220",fixed:"right"},{default:t(({row:a})=>[D("div",Ie,[l(d,{type:"primary",size:"small",onClick:B=>X(a)},{default:t(()=>e[19]||(e[19]=[r(" 编辑 ",-1)])),_:2,__:[19]},1032,["onClick"]),a.type==="menu"?(_(),y(d,{key:0,type:"success",size:"small",onClick:B=>Q(a)},{default:t(()=>e[20]||(e[20]=[r(" 添加子权限 ",-1)])),_:2,__:[20]},1032,["onClick"])):E("",!0),l(d,{type:a.status===1?"warning":"success",size:"small",onClick:B=>Y(a)},{default:t(()=>[r(w(a.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(d,{type:"danger",size:"small",onClick:B=>H(a)},{default:t(()=>e[21]||(e[21]=[r(" 删除 ",-1)])),_:2,__:[21]},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[oe,T.value]])]),_:1}),l(ae,{modelValue:b.value,"onUpdate:modelValue":e[12]||(e[12]=a=>b.value=a),title:k.value,width:"600px"},{footer:t(()=>[D("span",Ae,[l(d,{onClick:e[11]||(e[11]=a=>b.value=!1)},{default:t(()=>e[24]||(e[24]=[r("取消",-1)])),_:1,__:[24]}),l(d,{type:"primary",onClick:J},{default:t(()=>e[25]||(e[25]=[r("确定",-1)])),_:1,__:[25]})])]),default:t(()=>[l(R,{model:s,rules:O,ref_key:"permissionFormRef",ref:V,"label-width":"100px"},{default:t(()=>[h.value?(_(),y(u,{key:0,label:"上级权限"},{default:t(()=>[l(n,{value:h.value.name,disabled:""},null,8,["value"])]),_:1})):E("",!0),l(u,{label:"权限名称",prop:"name"},{default:t(()=>[l(n,{modelValue:s.name,"onUpdate:modelValue":e[3]||(e[3]=a=>s.name=a),placeholder:"请输入权限名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"权限编码",prop:"code"},{default:t(()=>[l(n,{modelValue:s.code,"onUpdate:modelValue":e[4]||(e[4]=a=>s.code=a),placeholder:"请输入权限编码"},null,8,["modelValue"])]),_:1}),l(u,{label:"权限类型",prop:"type"},{default:t(()=>[l($,{modelValue:s.type,"onUpdate:modelValue":e[5]||(e[5]=a=>s.type=a),placeholder:"请选择权限类型",style:{width:"100%"}},{default:t(()=>[l(i,{label:"菜单",value:"menu"}),l(i,{label:"按钮",value:"button"}),l(i,{label:"接口",value:"api"})]),_:1},8,["modelValue"])]),_:1}),s.type!=="button"?(_(),y(u,{key:1,label:"路径/接口",prop:"path"},{default:t(()=>[l(n,{modelValue:s.path,"onUpdate:modelValue":e[6]||(e[6]=a=>s.path=a),placeholder:"请输入路径或接口地址"},null,8,["modelValue"])]),_:1})):E("",!0),s.type==="menu"?(_(),y(u,{key:2,label:"图标",prop:"icon"},{default:t(()=>[l($,{modelValue:s.icon,"onUpdate:modelValue":e[7]||(e[7]=a=>s.icon=a),placeholder:"请选择图标",style:{width:"100%"}},{default:t(()=>[l(i,{label:"Document",value:"Document"}),l(i,{label:"User",value:"User"}),l(i,{label:"Setting",value:"Setting"}),l(i,{label:"List",value:"List"}),l(i,{label:"Plus",value:"Plus"}),l(i,{label:"Edit",value:"Edit"}),l(i,{label:"Delete",value:"Delete"})]),_:1},8,["modelValue"])]),_:1})):E("",!0),l(u,{label:"排序",prop:"sort"},{default:t(()=>[l(le,{modelValue:s.sort,"onUpdate:modelValue":e[8]||(e[8]=a=>s.sort=a),min:0,max:999},null,8,["modelValue"])]),_:1}),l(u,{label:"状态",prop:"status"},{default:t(()=>[l(te,{modelValue:s.status,"onUpdate:modelValue":e[9]||(e[9]=a=>s.status=a)},{default:t(()=>[l(A,{label:1},{default:t(()=>e[22]||(e[22]=[r("启用",-1)])),_:1,__:[22]}),l(A,{label:0},{default:t(()=>e[23]||(e[23]=[r("禁用",-1)])),_:1,__:[23]})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"描述",prop:"description"},{default:t(()=>[l(n,{modelValue:s.description,"onUpdate:modelValue":e[10]||(e[10]=a=>s.description=a),type:"textarea",rows:"3",placeholder:"请输入权限描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ll=Ue(Fe,[["__scopeId","data-v-14f0843b"]]);export{ll as default};
