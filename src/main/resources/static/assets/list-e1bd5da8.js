import{a1 as ce,N as B,p as _,V as pe,o as L,e as O,f as a,w as s,h as C,D as h,C as z,S as me,O as fe,a2 as ge,B as u,y as _e,a as R,t as T,Y as q,F as he,j as ye,i as be,Q as we,R as ve,Z as Ve,a3 as Ue,a4 as Le,X as Te,U as ke,_ as Ce,$ as Ee,a0 as xe,a5 as Se,a6 as Be,a7 as ze,a8 as Re}from"./index-df968ec9.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                *//* empty css               */import{_ as Ie}from"./_plugin-vue_export-helper-8da67cfc.js";import{f as M}from"./validate-ec87a090.js";import{g as Ne,c as $e,u as De,d as Fe,b as Pe,t as je,a as Oe,e as qe,f as Me,h as Ae,i as Ge,j as Qe,k as Xe,l as Ye}from"./user-c8e6b2be.js";import"./request-5c3d6a99.js";const Ze=ce("user",{state:()=>({userList:[],userTotal:0,userLoading:!1,roleList:[],roleTotal:0,roleLoading:!1,permissionTree:[],permissionLoading:!1}),actions:{async fetchUserList(r){this.userLoading=!0;try{const t=await Ne(r),o=t.data||t;return this.userList=o.records||[],this.userTotal=o.total||0,{data:o}}catch(t){return console.error("获取用户列表失败:",t),this.userList=[],this.userTotal=0,{data:{records:[],total:0}}}finally{this.userLoading=!1}},async createNewUser(r){try{const{data:t}=await $e(r);return t}catch(t){throw console.error("创建用户失败:",t),t}},async updateUserInfo(r,t){try{const{data:o}=await De(r,t);return o}catch(o){throw console.error("更新用户失败:",o),o}},async deleteUserById(r){try{await Fe(r),this.userList=this.userList.filter(t=>t.id!==r),this.userTotal--}catch(t){throw console.error("删除用户失败:",t),t}},async batchDeleteUsers(r){try{await Pe(r),this.userList=this.userList.filter(t=>!r.includes(t.id)),this.userTotal-=r.length}catch(t){throw console.error("批量删除用户失败:",t),t}},async toggleUserStatus(r,t){try{await je(r,t);const o=this.userList.find(d=>d.id===r);o&&(o.status=t)}catch(o){throw console.error("切换用户状态失败:",o),o}},async fetchRoleList(r){this.roleLoading=!0;try{const{data:t}=await Oe(r);return this.roleList=t.records||[],this.roleTotal=t.total||0,t}catch(t){return console.error("获取角色列表失败:",t),this.roleList=[],this.roleTotal=0,{records:[],total:0}}finally{this.roleLoading=!1}},async createNewRole(r){try{const{data:t}=await qe(r);return t}catch(t){throw console.error("创建角色失败:",t),t}},async updateRoleInfo(r,t){try{const{data:o}=await Me(r,t);return o}catch(o){throw console.error("更新角色失败:",o),o}},async deleteRoleById(r){try{await Ae(r),this.roleList=this.roleList.filter(t=>t.id!==r),this.roleTotal--}catch(t){throw console.error("删除角色失败:",t),t}},async fetchPermissionTree(){this.permissionLoading=!0;try{const{data:r}=await Ge();return this.permissionTree=r||[],r}catch(r){return console.error("获取权限树失败:",r),this.permissionTree=[],[]}finally{this.permissionLoading=!1}},async createNewPermission(r){try{const{data:t}=await Qe(r);return t}catch(t){throw console.error("创建权限失败:",t),t}},async updatePermissionInfo(r,t){try{const{data:o}=await Xe(r,t);return o}catch(o){throw console.error("更新权限失败:",o),o}},async deletePermissionById(r){try{await Ye(r)}catch(t){throw console.error("删除权限失败:",t),t}}}});const He={class:"app-container"},Je={class:"table-operations"},Ke={class:"table-actions"},We={class:"pagination-container"},et={class:"dialog-footer"},tt={__name:"list",setup(r){const t=Ze(),o=B({username:"",email:"",status:""}),d=B({current:1,size:10}),b=_([]),w=_(0),E=_(!1),v=_([]),I=_([]),y=_(!1),x=_(""),V=_(!1),U=_(null),i=B({id:null,username:"",nickname:"",email:"",phone:"",roleId:"",password:"",status:1}),A={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},g=async()=>{E.value=!0;try{const n={current:d.current,size:d.size,...o},e=await t.fetchUserList(n);e&&e.data?(b.value=e.data.records||[],w.value=e.data.total||0):e&&e.records!==void 0?(b.value=e.records||[],w.value=e.total||0):(b.value=[],w.value=0)}catch(n){console.error("获取用户列表失败:",n),h.error("获取用户列表失败: "+(n.message||"未知错误")),b.value=[],w.value=0}finally{E.value=!1}},G=()=>{d.current=1,g()},Q=()=>{Object.keys(o).forEach(n=>{o[n]=""}),d.current=1,g()},X=()=>{g()},Y=()=>{x.value="新增用户",V.value=!1,te(),y.value=!0},Z=n=>{x.value="编辑用户",V.value=!0,Object.assign(i,n),y.value=!0},H=async n=>{const e=n.status===1?"禁用":"启用";z.confirm(`确定要${e}用户 "${n.username}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const c=n.status===1?0:1;await t.toggleUserStatus(n.id,c),n.status=c,h.success(`${e}成功`)}catch(c){console.error(`${e}用户失败:`,c)}}).catch(()=>{})},J=n=>{z.confirm(`确定要删除用户 "${n.username}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await t.deleteUserById(n.id),h.success("删除成功"),g()}catch(e){console.error("删除用户失败:",e)}}).catch(()=>{})},K=()=>{if(v.value.length===0){h.warning("请选择要删除的用户");return}z.confirm(`确定要删除选中的 ${v.value.length} 个用户吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const n=v.value.map(e=>e.id);await t.batchDeleteUsers(n),h.success("批量删除成功"),g()}catch(n){console.error("批量删除用户失败:",n)}}).catch(()=>{})},W=n=>{v.value=n},ee=async()=>{U.value&&await U.value.validate(async n=>{if(n)try{V.value?(await t.updateUserInfo(i.id,i),h.success("编辑成功")):(await t.createNewUser(i),h.success("新增成功")),y.value=!1,g()}catch(e){console.error("操作失败:",e)}})},te=()=>{Object.assign(i,{id:null,username:"",nickname:"",email:"",phone:"",roleId:"",password:"",status:1}),U.value&&U.value.resetFields()},ae=n=>{d.size=n,g()},le=n=>{d.current=n,g()},se=async()=>{try{const e=await(await fetch("/api/role/all")).json();e.code===200&&(I.value=e.data||[])}catch(n){console.error("获取角色列表失败:",n)}};return pe(()=>{g(),se()}),(n,e)=>{const c=we,p=ve,k=Ve,S=Ue,N=Le,f=me,re=Te,$=ke,D=fe,m=Ce,F=Ee,oe=xe,ne=Se,P=Be,ie=ze,ue=ge,de=Re;return L(),O("div",He,[a(D,{class:"search-card"},{default:s(()=>[a($,{model:o,"label-width":"80px",class:"search-form"},{default:s(()=>[a(re,{gutter:20},{default:s(()=>[a(k,{span:6},{default:s(()=>[a(p,{label:"用户名"},{default:s(()=>[a(c,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=l=>o.username=l),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(k,{span:6},{default:s(()=>[a(p,{label:"邮箱"},{default:s(()=>[a(c,{modelValue:o.email,"onUpdate:modelValue":e[1]||(e[1]=l=>o.email=l),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(k,{span:6},{default:s(()=>[a(p,{label:"状态"},{default:s(()=>[a(N,{modelValue:o.status,"onUpdate:modelValue":e[2]||(e[2]=l=>o.status=l),placeholder:"请选择状态",clearable:"",style:{width:"100%"}},{default:s(()=>[a(S,{label:"启用",value:"1"}),a(S,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(k,{span:6},{default:s(()=>[a(p,{label:" ",class:"search-buttons"},{default:s(()=>[a(f,{type:"primary",onClick:G,icon:"Search"},{default:s(()=>e[14]||(e[14]=[u("搜索",-1)])),_:1,__:[14]}),a(f,{onClick:Q,icon:"Refresh"},{default:s(()=>e[15]||(e[15]=[u("重置",-1)])),_:1,__:[15]})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),C("div",Je,[a(f,{type:"primary",onClick:Y},{default:s(()=>e[16]||(e[16]=[u("新增用户",-1)])),_:1,__:[16]}),a(f,{type:"danger",disabled:v.value.length===0,onClick:K},{default:s(()=>e[17]||(e[17]=[u("批量删除",-1)])),_:1,__:[17]},8,["disabled"]),a(f,{type:"success",onClick:X},{default:s(()=>e[18]||(e[18]=[u("刷新",-1)])),_:1,__:[18]})]),a(D,{class:"table-card"},{default:s(()=>[_e((L(),R(oe,{data:b.value,stripe:"",class:"user-table",onSelectionChange:W},{default:s(()=>[a(m,{type:"selection",width:"55",align:"center"}),a(m,{prop:"id",label:"用户ID",width:"80"}),a(m,{prop:"username",label:"用户名","min-width":"120"}),a(m,{prop:"nickname",label:"昵称","min-width":"120"}),a(m,{prop:"email",label:"邮箱","min-width":"200"}),a(m,{prop:"phone",label:"手机号","min-width":"120"}),a(m,{prop:"roleName",label:"角色",width:"100"},{default:s(({row:l})=>[a(F,{type:l.roleName==="管理员"?"danger":"primary"},{default:s(()=>[u(T(l.roleName),1)]),_:2},1032,["type"])]),_:1}),a(m,{prop:"status",label:"状态",width:"80"},{default:s(({row:l})=>[a(F,{type:l.status===1?"success":"danger"},{default:s(()=>[u(T(l.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(m,{prop:"createTime",label:"创建时间",width:"160"},{default:s(({row:l})=>[u(T(q(M)(l.createTime)),1)]),_:1}),a(m,{prop:"lastLoginTime",label:"最后登录",width:"160"},{default:s(({row:l})=>[u(T(l.lastLoginTime?q(M)(l.lastLoginTime):"从未登录"),1)]),_:1}),a(m,{label:"操作",width:"220",fixed:"right"},{default:s(({row:l})=>[C("div",Ke,[a(f,{type:"primary",size:"small",onClick:j=>Z(l)},{default:s(()=>e[19]||(e[19]=[u(" 编辑 ",-1)])),_:2,__:[19]},1032,["onClick"]),a(f,{type:l.status===1?"warning":"success",size:"small",onClick:j=>H(l)},{default:s(()=>[u(T(l.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),a(f,{type:"danger",size:"small",onClick:j=>J(l)},{default:s(()=>e[20]||(e[20]=[u(" 删除 ",-1)])),_:2,__:[20]},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[de,E.value]]),C("div",We,[a(ne,{"current-page":d.current,"onUpdate:currentPage":e[3]||(e[3]=l=>d.current=l),"page-size":d.size,"onUpdate:pageSize":e[4]||(e[4]=l=>d.size=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:w.value,onSizeChange:ae,onCurrentChange:le},null,8,["current-page","page-size","total"])])]),_:1}),a(ue,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=l=>y.value=l),title:x.value,width:"600px"},{footer:s(()=>[C("span",et,[a(f,{onClick:e[12]||(e[12]=l=>y.value=!1)},{default:s(()=>e[23]||(e[23]=[u("取消",-1)])),_:1,__:[23]}),a(f,{type:"primary",onClick:ee},{default:s(()=>e[24]||(e[24]=[u("确定",-1)])),_:1,__:[24]})])]),default:s(()=>[a($,{model:i,rules:A,ref_key:"userFormRef",ref:U,"label-width":"100px"},{default:s(()=>[a(p,{label:"用户名",prop:"username"},{default:s(()=>[a(c,{modelValue:i.username,"onUpdate:modelValue":e[5]||(e[5]=l=>i.username=l),placeholder:"请输入用户名",disabled:V.value},null,8,["modelValue","disabled"])]),_:1}),a(p,{label:"昵称",prop:"nickname"},{default:s(()=>[a(c,{modelValue:i.nickname,"onUpdate:modelValue":e[6]||(e[6]=l=>i.nickname=l),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(p,{label:"邮箱",prop:"email"},{default:s(()=>[a(c,{modelValue:i.email,"onUpdate:modelValue":e[7]||(e[7]=l=>i.email=l),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(p,{label:"手机号",prop:"phone"},{default:s(()=>[a(c,{modelValue:i.phone,"onUpdate:modelValue":e[8]||(e[8]=l=>i.phone=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a(p,{label:"角色",prop:"roleId"},{default:s(()=>[a(N,{modelValue:i.roleId,"onUpdate:modelValue":e[9]||(e[9]=l=>i.roleId=l),placeholder:"请选择角色",style:{width:"100%"}},{default:s(()=>[(L(!0),O(he,null,ye(I.value,l=>(L(),R(S,{key:l.id,label:l.roleName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),V.value?be("",!0):(L(),R(p,{key:0,label:"密码",prop:"password"},{default:s(()=>[a(c,{modelValue:i.password,"onUpdate:modelValue":e[10]||(e[10]=l=>i.password=l),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),a(p,{label:"状态",prop:"status"},{default:s(()=>[a(ie,{modelValue:i.status,"onUpdate:modelValue":e[11]||(e[11]=l=>i.status=l)},{default:s(()=>[a(P,{label:1},{default:s(()=>e[21]||(e[21]=[u("启用",-1)])),_:1,__:[21]}),a(P,{label:0},{default:s(()=>e[22]||(e[22]=[u("禁用",-1)])),_:1,__:[22]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},yt=Ie(tt,[["__scopeId","data-v-ef1f5d20"]]);export{yt as default};
