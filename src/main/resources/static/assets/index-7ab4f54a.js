import{p as w,N as C,V as A,o as D,e as L,f as a,w as s,O as M,h as n,Y as j,B as v,D as p,at as z,I as J,E as T,Q,R as W,Z as X,X as Y,S as Z,U as $,au as G}from"./index-df968ec9.js";/* empty css                *//* empty css                 */import{_ as H}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css               *//* empty css                  */import{u as K}from"./auth-c297849c.js";import{s as k}from"./request-5c3d6a99.js";const ee={class:"profile-container"},ae={class:"profile-content"},se={class:"avatar-section"},re={class:"avatar-wrapper"},oe={class:"form-section"},le={class:"password-content"},te={__name:"index",setup(ne){const c=K(),y=w(null),_=w(null),I=w(null),P=w(!1),V=w(!1),r=C({username:"",nickname:"",email:"",phone:"",avatar:""}),d=C({oldPassword:"",newPassword:"",confirmPassword:""}),F={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},R={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(o,e,u)=>{e!==d.newPassword?u(new Error("两次输入的密码不一致")):u()},trigger:"blur"}]},U=()=>{const o=c.currentUser;Object.assign(r,{username:o.username||"",nickname:o.nickname||"",email:o.email||"",phone:o.phone||"",avatar:o.avatar||""})},S=()=>{var o;(o=I.value)==null||o.click()},B=async o=>{const e=o.target.files[0];if(!e)return;if(!e.type.startsWith("image/")){p.error("请选择图片文件");return}if(e.size>2*1024*1024){p.error("图片大小不能超过2MB");return}const u=z.service({lock:!0,text:"正在上传头像...",background:"rgba(0, 0, 0, 0.7)"});try{const f=new FormData;f.append("avatar",e);const i=await k({url:"/api/user/avatar",method:"post",data:f,headers:{"Content-Type":"multipart/form-data"}});r.avatar=i.data.avatarUrl,p.success("头像更新成功");const t={...c.currentUser,avatar:r.avatar};localStorage.setItem("userInfo",JSON.stringify(t)),c.userInfo=t}catch(f){p.error("头像上传失败: "+(f.message||"未知错误"))}finally{u.close(),o.target.value=""}},N=async()=>{y.value&&await y.value.validate(async o=>{if(o){P.value=!0;try{const e=await k({url:"/api/user/profile",method:"put",data:{nickname:r.nickname,email:r.email,phone:r.phone}});p.success("个人信息更新成功");const u={...c.currentUser,...r};localStorage.setItem("userInfo",JSON.stringify(u)),c.userInfo=u}catch(e){p.error("更新失败: "+(e.message||"未知错误"))}finally{P.value=!1}}})},q=()=>{U()},O=async()=>{_.value&&await _.value.validate(async o=>{if(o){V.value=!0;try{await k({url:"/api/user/password",method:"put",data:{oldPassword:d.oldPassword,newPassword:d.newPassword}}),p.success("密码修改成功"),h()}catch(e){p.error("密码修改失败: "+(e.message||"未知错误"))}finally{V.value=!1}}})},h=()=>{Object.assign(d,{oldPassword:"",newPassword:"",confirmPassword:""}),_.value&&_.value.resetFields()};return A(()=>{U()}),(o,e)=>{const u=J,f=T,i=Q,t=W,m=X,b=Y,g=Z,E=$,x=M;return D(),L("div",ee,[a(x,{class:"profile-card"},{header:s(()=>e[7]||(e[7]=[n("div",{class:"card-header"},[n("span",null,"个人信息")],-1)])),default:s(()=>[n("div",ae,[n("div",se,[n("div",re,[a(u,{size:120,src:r.avatar,icon:"UserFilled"},null,8,["src"]),n("div",{class:"avatar-overlay",onClick:S},[a(f,null,{default:s(()=>[a(j(G))]),_:1}),e[8]||(e[8]=n("span",null,"更换头像",-1))])]),n("input",{ref_key:"avatarInputRef",ref:I,type:"file",accept:"image/*",style:{display:"none"},onChange:B},null,544)]),n("div",oe,[a(E,{model:r,rules:F,ref_key:"userFormRef",ref:y,"label-width":"100px"},{default:s(()=>[a(b,{gutter:20},{default:s(()=>[a(m,{span:12},{default:s(()=>[a(t,{label:"用户名",prop:"username"},{default:s(()=>[a(i,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=l=>r.username=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{span:12},{default:s(()=>[a(t,{label:"昵称",prop:"nickname"},{default:s(()=>[a(i,{modelValue:r.nickname,"onUpdate:modelValue":e[1]||(e[1]=l=>r.nickname=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(b,{gutter:20},{default:s(()=>[a(m,{span:12},{default:s(()=>[a(t,{label:"邮箱",prop:"email"},{default:s(()=>[a(i,{modelValue:r.email,"onUpdate:modelValue":e[2]||(e[2]=l=>r.email=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{span:12},{default:s(()=>[a(t,{label:"手机号",prop:"phone"},{default:s(()=>[a(i,{modelValue:r.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>r.phone=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(t,null,{default:s(()=>[a(g,{type:"primary",onClick:N,loading:P.value},{default:s(()=>e[9]||(e[9]=[v(" 保存修改 ",-1)])),_:1,__:[9]},8,["loading"]),a(g,{onClick:q},{default:s(()=>e[10]||(e[10]=[v("重置",-1)])),_:1,__:[10]})]),_:1})]),_:1},8,["model"])])])]),_:1}),a(x,{class:"password-card"},{header:s(()=>e[11]||(e[11]=[n("div",{class:"card-header"},[n("span",null,"修改密码")],-1)])),default:s(()=>[n("div",le,[a(E,{model:d,rules:R,ref_key:"passwordFormRef",ref:_,"label-width":"100px"},{default:s(()=>[a(b,{gutter:20},{default:s(()=>[a(m,{span:8},{default:s(()=>[a(t,{label:"原密码",prop:"oldPassword"},{default:s(()=>[a(i,{modelValue:d.oldPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>d.oldPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{span:8},{default:s(()=>[a(t,{label:"新密码",prop:"newPassword"},{default:s(()=>[a(i,{modelValue:d.newPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>d.newPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{span:8},{default:s(()=>[a(t,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[a(i,{modelValue:d.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>d.confirmPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(t,null,{default:s(()=>[a(g,{type:"primary",onClick:O,loading:V.value},{default:s(()=>e[12]||(e[12]=[v(" 修改密码 ",-1)])),_:1,__:[12]},8,["loading"]),a(g,{onClick:h},{default:s(()=>e[13]||(e[13]=[v("重置",-1)])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])])]),_:1})])}}},we=H(te,[["__scopeId","data-v-deaae356"]]);export{we as default};
