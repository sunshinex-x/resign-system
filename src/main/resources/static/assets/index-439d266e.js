import{p as y,N as E,V as ye,o as T,e as X,f as a,w as l,D as _,O as ve,a2 as we,B as o,y as Z,a as R,t as n,h as D,A as F,C as G,Q as ge,R as be,Z as Ee,a3 as De,a4 as Ce,ab as Te,S as Ve,X as xe,U as he,_ as Ie,$ as ke,a0 as Ue,a5 as Se,ac as ze,ad as Pe,ae as Be,a8 as Le}from"./index-df968ec9.js";/* empty css                   *//* empty css                             *//* empty css                   *//* empty css                    *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                *//* empty css               */import{_ as Ne}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                       */import{g as Me,u as Oe,a as Re,d as Fe,b as $e,v as qe,c as Ye}from"./certificate-8c453a22.js";import"./request-5c3d6a99.js";const je={class:"app-container"},Ae={key:1,class:"text-muted"},Qe={class:"pagination-container"},Xe={class:"dialog-footer"},Ze={__name:"index",setup(Ge){const h=y(!1),I=y(!1),k=y(!1),U=y([]),$=y([]),p=y({}),s=E({name:"",type:"",createTimeStart:"",createTimeEnd:""}),w=y([]),u=E({page:1,size:10,total:0}),C=E({visible:!1}),S=E({visible:!1}),z=E({visible:!1}),i=E({name:"",type:"",password:"",file:null,description:""}),P=y(null),B=y(null),H={name:[{required:!0,message:"请输入证书名称",trigger:"blur"}],type:[{required:!0,message:"请选择证书类型",trigger:"change"}],password:[{required:!0,message:"请输入证书密码",trigger:"blur"}],file:[{required:!0,message:"请选择证书文件",trigger:"change"}]},v=async()=>{h.value=!0;try{const r={page:u.page,size:u.size,name:s.name,type:s.type,createTimeStart:s.createTimeStart,createTimeEnd:s.createTimeEnd},e=await Me(r);e.code===200&&e.data?(U.value=e.data.records||[],u.total=e.data.total||0):(U.value=[],u.total=0,console.error("获取iOS证书列表失败:",e.message))}catch{_.error("获取证书列表失败")}finally{h.value=!1}},J=()=>{w.value&&w.value.length===2?(s.createTimeStart=w.value[0],s.createTimeEnd=w.value[1]):(s.createTimeStart="",s.createTimeEnd=""),u.page=1,v()},K=()=>{s.name="",s.type="",s.createTimeStart="",s.createTimeEnd="",w.value=[],u.page=1,v()},W=()=>{v()},ee=r=>{u.size=r,u.page=1,v()},ae=r=>{u.page=r,v()},le=()=>{C.visible=!0,q()},q=()=>{i.name="",i.type="",i.password="",i.file=null,i.description="",B.value&&B.value.clearFiles()},te=r=>{i.file=r.raw},oe=()=>{i.file=null},re=async()=>{P.value&&await P.value.validate(async r=>{if(r){I.value=!0;try{const e=new FormData;e.append("name",i.name),e.append("type",i.type),e.append("password",i.password),e.append("file",i.file),e.append("description",i.description||""),await Oe(e),_.success("证书上传成功"),C.visible=!1,v()}catch{_.error("证书上传失败")}finally{I.value=!1}}})},ie=async r=>{k.value=!0,S.visible=!0;try{const e=await Re(r.id);$.value=e.data}catch{_.error("获取Profile列表失败")}finally{k.value=!1}},se=async r=>{try{await Fe(r.id),_.success("下载成功")}catch{_.error("下载失败")}},ne=async r=>{try{const e=await $e(r.id);p.value=e.data,z.visible=!0}catch{_.error("获取证书详情失败")}},de=async r=>{try{const{value:e}=await G.prompt("请输入证书密码","验证证书",{confirmButtonText:"验证",cancelButtonText:"取消",inputType:"password"});await qe(r.id,{password:e}),_.success("证书验证成功")}catch(e){e!=="cancel"&&_.error("证书验证失败")}},pe=async r=>{try{await G.confirm("确定要删除这个证书吗？删除后关联的描述文件也会被删除。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ye(r.id),_.success("删除成功"),v()}catch(e){e!=="cancel"&&_.error("删除失败")}},L=r=>{if(!r)return!1;const e=new Date(r),b=new Date,f=e.getTime()-b.getTime(),g=Math.ceil(f/(1e3*60*60*24));return g<=30&&g>=0};return ye(()=>{v()}),(r,e)=>{const b=ge,f=be,g=Ee,V=De,Y=Ce,ue=Te,m=Ve,me=xe,j=he,N=ve,d=Ie,M=ke,A=Ue,ce=Se,fe=ze,O=we,c=Pe,_e=Be,Q=Le;return T(),X("div",je,[a(N,{class:"search-card"},{default:l(()=>[a(j,{model:s,"label-width":"80px",class:"search-form"},{default:l(()=>[a(me,{gutter:20},{default:l(()=>[a(g,{span:6},{default:l(()=>[a(f,{label:"证书名称"},{default:l(()=>[a(b,{modelValue:s.name,"onUpdate:modelValue":e[0]||(e[0]=t=>s.name=t),placeholder:"请输入证书名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{span:6},{default:l(()=>[a(f,{label:"证书类型"},{default:l(()=>[a(Y,{modelValue:s.type,"onUpdate:modelValue":e[1]||(e[1]=t=>s.type=t),placeholder:"请选择证书类型",clearable:"",style:{width:"100%"}},{default:l(()=>[a(V,{label:"开发证书",value:"DEVELOPMENT"}),a(V,{label:"发布证书",value:"DISTRIBUTION"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(g,{span:6},{default:l(()=>[a(f,{label:"创建时间"},{default:l(()=>[a(ue,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{span:6},{default:l(()=>[a(f,{label:" ",class:"search-buttons"},{default:l(()=>[a(m,{type:"primary",onClick:J,icon:"Search"},{default:l(()=>e[13]||(e[13]=[o("搜索",-1)])),_:1,__:[13]}),a(m,{onClick:K,icon:"Refresh"},{default:l(()=>e[14]||(e[14]=[o("重置",-1)])),_:1,__:[14]})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(N,{class:"operation-card"},{default:l(()=>[a(m,{type:"primary",onClick:le,icon:"Upload"},{default:l(()=>e[15]||(e[15]=[o("上传证书",-1)])),_:1,__:[15]}),a(m,{type:"success",onClick:W,icon:"Refresh"},{default:l(()=>e[16]||(e[16]=[o("刷新",-1)])),_:1,__:[16]})]),_:1}),a(N,null,{default:l(()=>[Z((T(),R(A,{data:U.value,style:{width:"100%"}},{default:l(()=>[a(d,{prop:"name",label:"证书名称",width:"200"}),a(d,{label:"证书类型",width:"120"},{default:l(t=>[a(M,{type:t.row.type==="DEVELOPMENT"?"primary":"success"},{default:l(()=>[o(n(t.row.type==="DEVELOPMENT"?"开发证书":"发布证书"),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"teamId",label:"Team ID",width:"120"}),a(d,{prop:"bundleId",label:"Bundle ID",width:"200","show-overflow-tooltip":""}),a(d,{label:"关联Profile",width:"120"},{default:l(t=>[t.row.profileCount>0?(T(),R(m,{key:0,type:"info",size:"small",onClick:x=>ie(t.row)},{default:l(()=>[o(n(t.row.profileCount)+"个 ",1)]),_:2},1032,["onClick"])):(T(),X("span",Ae,"无"))]),_:1}),a(d,{prop:"expiryDate",label:"过期时间",width:"120"},{default:l(t=>[D("span",{class:F({"text-danger":L(t.row.expiryDate)})},n(t.row.expiryDate),3)]),_:1}),a(d,{prop:"description",label:"描述","show-overflow-tooltip":""}),a(d,{prop:"createTime",label:"创建时间",width:"180"}),a(d,{label:"操作",width:"200",fixed:"right"},{default:l(t=>[a(m,{type:"primary",size:"small",onClick:x=>ne(t.row)},{default:l(()=>e[17]||(e[17]=[o("详情",-1)])),_:2,__:[17]},1032,["onClick"]),a(m,{type:"warning",size:"small",onClick:x=>de(t.row)},{default:l(()=>e[18]||(e[18]=[o("验证",-1)])),_:2,__:[18]},1032,["onClick"]),a(m,{type:"danger",size:"small",onClick:x=>pe(t.row)},{default:l(()=>e[19]||(e[19]=[o("删除",-1)])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,h.value]]),D("div",Qe,[a(ce,{"current-page":u.page,"onUpdate:currentPage":e[3]||(e[3]=t=>u.page=t),"page-size":u.size,"onUpdate:pageSize":e[4]||(e[4]=t=>u.size=t),"page-sizes":[10,20,50,100],total:u.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ee,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1}),a(O,{modelValue:C.visible,"onUpdate:modelValue":e[10]||(e[10]=t=>C.visible=t),title:"上传iOS证书",width:"600px",onClose:q},{footer:l(()=>[D("div",Xe,[a(m,{onClick:e[9]||(e[9]=t=>C.visible=!1)},{default:l(()=>e[22]||(e[22]=[o("取消",-1)])),_:1,__:[22]}),a(m,{type:"primary",onClick:re,loading:I.value},{default:l(()=>e[23]||(e[23]=[o("上传",-1)])),_:1,__:[23]},8,["loading"])])]),default:l(()=>[a(j,{ref_key:"uploadFormRef",ref:P,model:i,rules:H,"label-width":"100px"},{default:l(()=>[a(f,{label:"证书名称",prop:"name"},{default:l(()=>[a(b,{modelValue:i.name,"onUpdate:modelValue":e[5]||(e[5]=t=>i.name=t),placeholder:"请输入证书名称"},null,8,["modelValue"])]),_:1}),a(f,{label:"证书类型",prop:"type"},{default:l(()=>[a(Y,{modelValue:i.type,"onUpdate:modelValue":e[6]||(e[6]=t=>i.type=t),placeholder:"请选择证书类型",style:{width:"100%"}},{default:l(()=>[a(V,{label:"开发证书",value:"DEVELOPMENT"}),a(V,{label:"发布证书",value:"DISTRIBUTION"})]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"证书密码",prop:"password"},{default:l(()=>[a(b,{modelValue:i.password,"onUpdate:modelValue":e[7]||(e[7]=t=>i.password=t),type:"password",placeholder:"请输入证书密码","show-password":""},null,8,["modelValue"])]),_:1}),a(f,{label:"证书文件",prop:"file"},{default:l(()=>[a(fe,{ref_key:"uploadRef",ref:B,"auto-upload":!1,"show-file-list":!0,limit:1,accept:".p12,.pfx",onChange:te,onRemove:oe},{tip:l(()=>e[21]||(e[21]=[D("div",{class:"upload-tip"},"支持 .p12/.pfx 格式证书文件",-1)])),default:l(()=>[a(m,{type:"primary",icon:"Upload"},{default:l(()=>e[20]||(e[20]=[o("选择文件",-1)])),_:1,__:[20]})]),_:1},512)]),_:1}),a(f,{label:"描述"},{default:l(()=>[a(b,{modelValue:i.description,"onUpdate:modelValue":e[8]||(e[8]=t=>i.description=t),type:"textarea",rows:3,placeholder:"请输入证书描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(O,{modelValue:S.visible,"onUpdate:modelValue":e[11]||(e[11]=t=>S.visible=t),title:"关联的描述文件",width:"800px"},{default:l(()=>[Z((T(),R(A,{data:$.value,style:{width:"100%"}},{default:l(()=>[a(d,{prop:"name",label:"Profile名称",width:"200"}),a(d,{prop:"bundleId",label:"Bundle ID",width:"200"}),a(d,{label:"类型",width:"100"},{default:l(t=>[a(M,{type:t.row.type==="DEVELOPMENT"?"primary":"success"},{default:l(()=>[o(n(t.row.type==="DEVELOPMENT"?"开发":"发布"),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"teamId",label:"Team ID",width:"120"}),a(d,{prop:"expiryDate",label:"过期时间",width:"120"},{default:l(t=>[D("span",{class:F({"text-danger":L(t.row.expiryDate)})},n(t.row.expiryDate),3)]),_:1}),a(d,{prop:"createTime",label:"创建时间",width:"180"}),a(d,{label:"操作",width:"100"},{default:l(t=>[a(m,{type:"primary",size:"small",onClick:x=>se(t.row)},{default:l(()=>e[24]||(e[24]=[o("下载",-1)])),_:2,__:[24]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,k.value]])]),_:1},8,["modelValue"]),a(O,{modelValue:z.visible,"onUpdate:modelValue":e[12]||(e[12]=t=>z.visible=t),title:"证书详情",width:"600px"},{default:l(()=>[a(_e,{column:2,border:""},{default:l(()=>[a(c,{label:"证书名称"},{default:l(()=>[o(n(p.value.name),1)]),_:1}),a(c,{label:"证书类型"},{default:l(()=>[a(M,{type:p.value.type==="DEVELOPMENT"?"primary":"success"},{default:l(()=>[o(n(p.value.type==="DEVELOPMENT"?"开发证书":"发布证书"),1)]),_:1},8,["type"])]),_:1}),a(c,{label:"Team ID"},{default:l(()=>[o(n(p.value.teamId),1)]),_:1}),a(c,{label:"Bundle ID"},{default:l(()=>[o(n(p.value.bundleId),1)]),_:1}),a(c,{label:"序列号"},{default:l(()=>[o(n(p.value.serialNumber),1)]),_:1}),a(c,{label:"指纹"},{default:l(()=>[o(n(p.value.fingerprint),1)]),_:1}),a(c,{label:"颁发者"},{default:l(()=>[o(n(p.value.issuer),1)]),_:1}),a(c,{label:"主题"},{default:l(()=>[o(n(p.value.subject),1)]),_:1}),a(c,{label:"生效时间"},{default:l(()=>[o(n(p.value.validFrom),1)]),_:1}),a(c,{label:"过期时间"},{default:l(()=>[D("span",{class:F({"text-danger":L(p.value.expiryDate)})},n(p.value.expiryDate),3)]),_:1}),a(c,{label:"创建时间"},{default:l(()=>[o(n(p.value.createTime),1)]),_:1}),a(c,{label:"描述",span:2},{default:l(()=>[o(n(p.value.description||"无"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},ca=Ne(Ze,[["__scopeId","data-v-c4b8aa5a"]]);export{ca as default};
